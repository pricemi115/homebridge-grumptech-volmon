import*as e from"os";import*as t from"fs/promises";import*as r from"fs";import*as n from"child_process";import*as o from"url";import*as i from"path";var s={742:(e,t)=>{t.byteLength=function(e){var t=c(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){var t,r,i=c(e),s=i[0],a=i[1],u=new o(function(e,t,r){return 3*(t+r)/4-r}(0,s,a)),l=0,h=a>0?s-4:s;for(r=0;r<h;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],u[l++]=t>>16&255,u[l++]=t>>8&255,u[l++]=255&t;return 2===a&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,u[l++]=255&t),1===a&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,u[l++]=t>>8&255,u[l++]=255&t),u},t.fromByteArray=function(e){for(var t,n=e.length,o=n%3,i=[],s=16383,a=0,c=n-o;a<c;a+=s)i.push(u(e,a,a+s>c?c:a+s));return 1===o?(t=e[n-1],i.push(r[t>>2]+r[t<<4&63]+"==")):2===o&&(t=(e[n-2]<<8)+e[n-1],i.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),i.join("")};for(var r=[],n=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,a=i.length;s<a;++s)r[s]=i[s],n[i.charCodeAt(s)]=s;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function u(e,t,n){for(var o,i,s=[],a=t;a<n;a+=3)o=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(r[(i=o)>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return s.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},227:(e,t,r)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,o=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(n++,"%c"===e&&(o=n))})),t.splice(o,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=r(447)(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},447:(e,t,r)=>{e.exports=function(e){function t(e){let r,o,i,s=null;function a(...e){if(!a.enabled)return;const n=a,o=Number(new Date),i=o-(r||o);n.diff=i,n.prev=r,n.curr=o,r=o,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,o)=>{if("%%"===r)return"%";s++;const i=t.formatters[o];if("function"==typeof i){const t=e[s];r=i.call(n,t),e.splice(s,1),s--}return r})),t.formatArgs.call(n,e),(n.log||t.log).apply(n,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=n,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==s?s:(o!==t.namespaces&&(o=t.namespaces,i=t.enabled(e)),i),set:e=>{s=e}}),"function"==typeof t.init&&t.init(a),a}function n(e,r){const n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function o(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(o),...t.skips.map(o).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),o=n.length;for(r=0;r<o;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(824),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},187:e=>{var t,r="object"==typeof Reflect?Reflect:null,n=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function i(){i.init.call(this)}e.exports=i,e.exports.once=function(e,t){return new Promise((function(r,n){function o(r){e.removeListener(t,i),n(r)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",o),r([].slice.call(arguments))}m(e,t,i,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&m(e,"error",t,{once:!0})}(e,o)}))},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var s=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function u(e,t,r,n){var o,i,s,u;if(a(r),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),i=e._events),s=i[t]),void 0===s)s=i[t]=r,++e._eventsCount;else if("function"==typeof s?s=i[t]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),(o=c(e))>0&&s.length>o&&!s.warned){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=s.length,u=l,console&&console.warn&&console.warn(u)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},o=l.bind(n);return o.listener=r,n.wrapFn=o,o}function p(e,t,r){var n=e._events;if(void 0===n)return[];var o=n[t];return void 0===o?[]:"function"==typeof o?r?[o.listener||o]:[o]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(o):f(o,o.length)}function d(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function f(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function m(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function o(i){n.once&&e.removeEventListener(t,o),r(i)}))}}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),i.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return c(this)},i.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var o="error"===e,i=this._events;if(void 0!==i)o=o&&void 0===i.error;else if(!o)return!1;if(o){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)n(c,this,t);else{var u=c.length,l=f(c,u);for(r=0;r<u;++r)n(l[r],this,t)}return!0},i.prototype.addListener=function(e,t){return u(this,e,t,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,t){return u(this,e,t,!0)},i.prototype.once=function(e,t){return a(t),this.on(e,h(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,h(this,e,t)),this},i.prototype.removeListener=function(e,t){var r,n,o,i,s;if(a(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(o=-1,i=r.length-1;i>=0;i--)if(r[i]===t||r[i].listener===t){s=r[i].listener,o=i;break}if(o<0)return this;0===o?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,o),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var o,i=Object.keys(r);for(n=0;n<i.length;++n)"removeListener"!==(o=i[n])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},i.prototype.listeners=function(e){return p(this,e,!0)},i.prototype.rawListeners=function(e){return p(this,e,!1)},i.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):d.call(e,t)},i.prototype.listenerCount=d,i.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},824:e=>{var t=1e3,r=60*t,n=60*r,o=24*n;function i(e,t,r,n){var o=t>=1.5*r;return Math.round(e/r)+" "+n+(o?"s":"")}e.exports=function(e,s){s=s||{};var a,c,u=typeof e;if("string"===u&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var i=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(i){var s=parseFloat(i[1]);switch((i[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*s;case"weeks":case"week":case"w":return 6048e5*s;case"days":case"day":case"d":return s*o;case"hours":case"hour":case"hrs":case"hr":case"h":return s*n;case"minutes":case"minute":case"mins":case"min":case"m":return s*r;case"seconds":case"second":case"secs":case"sec":case"s":return s*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}}}(e);if("number"===u&&isFinite(e))return s.long?(a=e,(c=Math.abs(a))>=o?i(a,c,o,"day"):c>=n?i(a,c,n,"hour"):c>=r?i(a,c,r,"minute"):c>=t?i(a,c,t,"second"):a+" ms"):function(e){var i=Math.abs(e);return i>=o?Math.round(e/o)+"d":i>=n?Math.round(e/n)+"h":i>=r?Math.round(e/r)+"m":i>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},78:(e,t,r)=>{var n=r(518);Object.keys(n).forEach((function(e){t[e]=n[e]}));var o=r(941);Object.keys(o).forEach((function(e){t[e]=o[e]}))},941:(e,t,r)=>{var n=r(742),o=r(532);t.build=function(e,t){var r={version:"1.0",encoding:"UTF-8"},n="-//Apple//DTD PLIST 1.0//EN",i="http://www.apple.com/DTDs/PropertyList-1.0.dtd",s=o.create("plist");return s.dec(r.version,r.encoding,r.standalone),s.dtd(n,i),s.att("version","1.0"),a(e,s),t||(t={}),t.pretty=!1!==t.pretty,s.end(t)};var i=Object.prototype.toString;function s(e){var t=i.call(e).match(/\[object (.*)\]/);return t?t[1]:t}function a(e,t){var r,o,i,c=s(e);if("Undefined"!=c)if(Array.isArray(e))for(t=t.ele("array"),o=0;o<e.length;o++)a(e[o],t);else if(Buffer.isBuffer(e))t.ele("data").raw(e.toString("base64"));else if("Object"==c)for(i in t=t.ele("dict"),e)e.hasOwnProperty(i)&&(t.ele("key").txt(i),a(e[i],t));else"Number"==c?(r=e%1==0?"integer":"real",t.ele(r).txt(e.toString())):"Date"==c?t.ele("date").txt(function(e){function t(e){return e<10?"0"+e:e}return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"Z"}(new Date(e))):"Boolean"==c?t.ele(e?"true":"false"):"String"==c?t.ele("string").txt(e):"ArrayBuffer"==c?t.ele("data").raw(n.fromByteArray(e)):e&&e.buffer&&"ArrayBuffer"==s(e.buffer)&&t.ele("data").raw(n.fromByteArray(new Uint8Array(e.buffer),t))}},518:(e,t,r)=>{var n=r(470).a;function o(e){return 3===e.nodeType||8===e.nodeType||4===e.nodeType}function i(e){return!e.childNodes||0===e.childNodes.length}function s(e,t){if(!e)throw new Error(t)}function a(e){var t,r,n,c,u,l;if(!e)return null;if("plist"===e.nodeName){if(c=[],i(e))return c;for(t=0;t<e.childNodes.length;t++)o(e.childNodes[t])||c.push(a(e.childNodes[t]));return c}if("dict"===e.nodeName){if(r={},n=null,l=0,i(e))return r;for(t=0;t<e.childNodes.length;t++)o(e.childNodes[t])||(l%2==0?(s("key"===e.childNodes[t].nodeName,"Missing key while parsing <dict/>."),n=a(e.childNodes[t])):(s("key"!==e.childNodes[t].nodeName,'Unexpected key "'+a(e.childNodes[t])+'" while parsing <dict/>.'),r[n]=a(e.childNodes[t])),l+=1);if(l%2==1)throw new Error('Missing value for "'+n+'" while parsing <dict/>');return r}if("array"===e.nodeName){if(c=[],i(e))return c;for(t=0;t<e.childNodes.length;t++)o(e.childNodes[t])||null!=(u=a(e.childNodes[t]))&&c.push(u);return c}if("#text"===e.nodeName);else{if("key"===e.nodeName)return i(e)?"":(s("__proto__"!==e.childNodes[0].nodeValue,"__proto__ keys can lead to prototype pollution. More details on CVE-2022-22912"),e.childNodes[0].nodeValue);if("string"===e.nodeName){if(u="",i(e))return u;for(t=0;t<e.childNodes.length;t++){var h;3!==(h=e.childNodes[t].nodeType)&&4!==h||(u+=e.childNodes[t].nodeValue)}return u}if("integer"===e.nodeName)return s(!i(e),'Cannot parse "" as integer.'),parseInt(e.childNodes[0].nodeValue,10);if("real"===e.nodeName){for(s(!i(e),'Cannot parse "" as real.'),u="",t=0;t<e.childNodes.length;t++)3===e.childNodes[t].nodeType&&(u+=e.childNodes[t].nodeValue);return parseFloat(u)}if("data"===e.nodeName){if(u="",i(e))return Buffer.from(u,"base64");for(t=0;t<e.childNodes.length;t++)3===e.childNodes[t].nodeType&&(u+=e.childNodes[t].nodeValue.replace(/\s+/g,""));return Buffer.from(u,"base64")}if("date"===e.nodeName)return s(!i(e),'Cannot parse "" as Date.'),new Date(e.childNodes[0].nodeValue);if("true"===e.nodeName)return!0;if("false"===e.nodeName)return!1}}t.parse=function(e){var t=(new n).parseFromString(e);s("plist"===t.documentElement.nodeName,"malformed document. First element should be <plist>");var r=a(t.documentElement);return 1==r.length&&(r=r[0]),r}},470:(e,t,r)=>{function n(e){this.options=e||{locator:{}}}function o(){this.cdata=!1}function i(e,t){t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber}function s(e){if(e)return"\n@"+(e.systemId||"")+"#[line:"+e.lineNumber+",col:"+e.columnNumber+"]"}function a(e,t,r){return"string"==typeof e?e.substr(t,r):e.length>=t+r||t?new java.lang.String(e,t,r)+"":e}function c(e,t){e.currentElement?e.currentElement.appendChild(t):e.doc.appendChild(t)}n.prototype.parseFromString=function(e,t){var r=this.options,n=new h,i=r.domBuilder||new o,a=r.errorHandler,c=r.locator,l=r.xmlns||{},p=/\/x?html?$/.test(t),d=p?u.entityMap:{lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return c&&i.setDocumentLocator(c),n.errorHandler=function(e,t,r){if(!e){if(t instanceof o)return t;e=t}var n={},i=e instanceof Function;function a(t){var o=e[t];!o&&i&&(o=2==e.length?function(r){e(t,r)}:e),n[t]=o&&function(e){o("[xmldom "+t+"]\t"+e+s(r))}||function(){}}return r=r||{},a("warning"),a("error"),a("fatalError"),n}(a,i,c),n.domBuilder=r.domBuilder||i,p&&(l[""]="http://www.w3.org/1999/xhtml"),l.xml=l.xml||"http://www.w3.org/XML/1998/namespace",e&&"string"==typeof e?n.parse(e,l,d):n.errorHandler.error("invalid doc source"),i.doc},o.prototype={startDocument:function(){this.doc=(new d).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(e,t,r,n){var o=this.doc,s=o.createElementNS(e,r||t),a=n.length;c(this,s),this.currentElement=s,this.locator&&i(this.locator,s);for(var u=0;u<a;u++){e=n.getURI(u);var l=n.getValue(u),h=(r=n.getQName(u),o.createAttributeNS(e,r));this.locator&&i(n.getLocator(u),h),h.value=h.nodeValue=l,s.setAttributeNode(h)}},endElement:function(e,t,r){var n=this.currentElement;n.tagName,this.currentElement=n.parentNode},startPrefixMapping:function(e,t){},endPrefixMapping:function(e){},processingInstruction:function(e,t){var r=this.doc.createProcessingInstruction(e,t);this.locator&&i(this.locator,r),c(this,r)},ignorableWhitespace:function(e,t,r){},characters:function(e,t,r){if(e=a.apply(this,arguments)){if(this.cdata)var n=this.doc.createCDATASection(e);else n=this.doc.createTextNode(e);this.currentElement?this.currentElement.appendChild(n):/^\s*$/.test(e)&&this.doc.appendChild(n),this.locator&&i(this.locator,n)}},skippedEntity:function(e){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(e){(this.locator=e)&&(e.lineNumber=0)},comment:function(e,t,r){e=a.apply(this,arguments);var n=this.doc.createComment(e);this.locator&&i(this.locator,n),c(this,n)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(e,t,r){var n=this.doc.implementation;if(n&&n.createDocumentType){var o=n.createDocumentType(e,t,r);this.locator&&i(this.locator,o),c(this,o)}},warning:function(e){console.warn("[xmldom warning]\t"+e,s(this.locator))},error:function(e){console.error("[xmldom error]\t"+e,s(this.locator))},fatalError:function(e){throw new p(e,this.locator)}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,(function(e){o.prototype[e]=function(){return null}}));var u=r(444),l=r(552),h=l.XMLReader,p=l.ParseError,d=r(457).DOMImplementation;r(457),t.a=n},457:(e,t)=>{function r(e,t){for(var r in e)t[r]=e[r]}function n(e,t){var n=e.prototype;if(!(n instanceof t)){function o(){}o.prototype=t.prototype,r(n,o=new o),e.prototype=n=o}n.constructor!=e&&("function"!=typeof e&&console.error("unknow Class:"+e),n.constructor=e)}var o={},i=o.ELEMENT_NODE=1,s=o.ATTRIBUTE_NODE=2,a=o.TEXT_NODE=3,c=o.CDATA_SECTION_NODE=4,u=o.ENTITY_REFERENCE_NODE=5,l=o.ENTITY_NODE=6,h=o.PROCESSING_INSTRUCTION_NODE=7,p=o.COMMENT_NODE=8,d=o.DOCUMENT_NODE=9,f=o.DOCUMENT_TYPE_NODE=10,m=o.DOCUMENT_FRAGMENT_NODE=11,y=o.NOTATION_NODE=12,_={},g={},v=(_.INDEX_SIZE_ERR=(g[1]="Index size error",1),_.DOMSTRING_SIZE_ERR=(g[2]="DOMString size error",2),_.HIERARCHY_REQUEST_ERR=(g[3]="Hierarchy request error",3)),w=(_.WRONG_DOCUMENT_ERR=(g[4]="Wrong document",4),_.INVALID_CHARACTER_ERR=(g[5]="Invalid character",5),_.NO_DATA_ALLOWED_ERR=(g[6]="No data allowed",6),_.NO_MODIFICATION_ALLOWED_ERR=(g[7]="No modification allowed",7),_.NOT_FOUND_ERR=(g[8]="Not found",8)),b=(_.NOT_SUPPORTED_ERR=(g[9]="Not supported",9),_.INUSE_ATTRIBUTE_ERR=(g[10]="Attribute in use",10));function N(e,t){if(t instanceof Error)var r=t;else r=this,Error.call(this,g[e]),this.message=g[e],Error.captureStackTrace&&Error.captureStackTrace(this,N);return r.code=e,t&&(this.message=this.message+": "+t),r}function E(){}function C(e,t){this._node=e,this._refresh=t,I(this)}function I(e){var t=e._node._inc||e._node.ownerDocument._inc;if(e._inc!=t){var n=e._refresh(e._node);re(e,"length",n.length),r(n,e),e._inc=t}}function O(){}function S(e,t){for(var r=e.length;r--;)if(e[r]===t)return r}function D(e,t,r,n){if(n?t[S(t,n)]=r:t[t.length++]=r,e){r.ownerElement=e;var o=e.ownerDocument;o&&(n&&L(o,e,n),function(e,t,r){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==r.namespaceURI&&(t._nsMap[r.prefix?r.localName:""]=r.value)}(o,e,r))}}function A(e,t,r){var n=S(t,r);if(!(n>=0))throw N(w,new Error(e.tagName+"@"+r));for(var o=t.length-1;n<o;)t[n]=t[++n];if(t.length=o,e){var i=e.ownerDocument;i&&(L(i,e,r),r.ownerElement=null)}}function T(e){if(this._features={},e)for(var t in e)this._features=e[t]}function x(){}function P(e){return("<"==e?"&lt;":">"==e&&"&gt;")||"&"==e&&"&amp;"||'"'==e&&"&quot;"||"&#"+e.charCodeAt()+";"}function k(e,t){if(t(e))return!0;if(e=e.firstChild)do{if(k(e,t))return!0}while(e=e.nextSibling)}function F(){}function L(e,t,r,n){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==r.namespaceURI&&delete t._nsMap[r.prefix?r.localName:""]}function R(e,t,r){if(e&&e._inc){e._inc++;var n=t.childNodes;if(r)n[n.length++]=r;else{for(var o=t.firstChild,i=0;o;)n[i++]=o,o=o.nextSibling;n.length=i}}}function $(e,t){var r=t.previousSibling,n=t.nextSibling;return r?r.nextSibling=n:e.firstChild=n,n?n.previousSibling=r:e.lastChild=r,R(e.ownerDocument,e),t}function V(e,t,r){var n=t.parentNode;if(n&&n.removeChild(t),t.nodeType===m){var o=t.firstChild;if(null==o)return t;var i=t.lastChild}else o=i=t;var s=r?r.previousSibling:e.lastChild;o.previousSibling=s,i.nextSibling=r,s?s.nextSibling=o:e.firstChild=o,null==r?e.lastChild=i:r.previousSibling=i;do{o.parentNode=e}while(o!==i&&(o=o.nextSibling));return R(e.ownerDocument||e,e),t.nodeType==m&&(t.firstChild=t.lastChild=null),t}function j(){this._nsMap={}}function U(){}function M(){}function B(){}function z(){}function q(){}function G(){}function W(){}function Y(){}function H(){}function K(){}function X(){}function Z(e,t){var r=[],n=9==this.nodeType&&this.documentElement||this,o=n.prefix,i=n.namespaceURI;if(i&&null==o&&null==(o=n.lookupPrefix(i)))var s=[{namespace:i,prefix:null}];return J(this,r,e,t,s),r.join("")}function Q(e,t,r){var n=e.prefix||"",o=e.namespaceURI;if(!n&&!o)return!1;if("xml"===n&&"http://www.w3.org/XML/1998/namespace"===o||"http://www.w3.org/2000/xmlns/"==o)return!1;for(var i=r.length;i--;){var s=r[i];if(s.prefix==n)return s.namespace!=o}return!0}function J(e,t,r,n,o){if(n){if(!(e=n(e)))return;if("string"==typeof e)return void t.push(e)}switch(e.nodeType){case i:o||(o=[]),o.length;var l=e.attributes,y=l.length,_=e.firstChild,g=e.tagName;r="http://www.w3.org/1999/xhtml"===e.namespaceURI||r,t.push("<",g);for(var v=0;v<y;v++)"xmlns"==(w=l.item(v)).prefix?o.push({prefix:w.localName,namespace:w.value}):"xmlns"==w.nodeName&&o.push({prefix:"",namespace:w.value});for(v=0;v<y;v++){var w;if(Q(w=l.item(v),0,o)){var b=w.prefix||"",N=w.namespaceURI,E=b?" xmlns:"+b:" xmlns";t.push(E,'="',N,'"'),o.push({prefix:b,namespace:N})}J(w,t,r,n,o)}if(Q(e,0,o)&&(b=e.prefix||"",(N=e.namespaceURI)&&(E=b?" xmlns:"+b:" xmlns",t.push(E,'="',N,'"'),o.push({prefix:b,namespace:N}))),_||r&&!/^(?:meta|link|img|br|hr|input)$/i.test(g)){if(t.push(">"),r&&/^script$/i.test(g))for(;_;)_.data?t.push(_.data):J(_,t,r,n,o),_=_.nextSibling;else for(;_;)J(_,t,r,n,o),_=_.nextSibling;t.push("</",g,">")}else t.push("/>");return;case d:case m:for(_=e.firstChild;_;)J(_,t,r,n,o),_=_.nextSibling;return;case s:return t.push(" ",e.name,'="',e.value.replace(/[<&"]/g,P),'"');case a:return t.push(e.data.replace(/[<&]/g,P).replace(/]]>/g,"]]&gt;"));case c:return t.push("<![CDATA[",e.data,"]]>");case p:return t.push("\x3c!--",e.data,"--\x3e");case f:var C=e.publicId,I=e.systemId;if(t.push("<!DOCTYPE ",e.name),C)t.push(" PUBLIC ",C),I&&"."!=I&&t.push(" ",I),t.push(">");else if(I&&"."!=I)t.push(" SYSTEM ",I,">");else{var O=e.internalSubset;O&&t.push(" [",O,"]"),t.push(">")}return;case h:return t.push("<?",e.target," ",e.data,"?>");case u:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function ee(e,t,r){var n;switch(t.nodeType){case i:(n=t.cloneNode(!1)).ownerDocument=e;case m:break;case s:r=!0}if(n||(n=t.cloneNode(!1)),n.ownerDocument=e,n.parentNode=null,r)for(var o=t.firstChild;o;)n.appendChild(ee(e,o,r)),o=o.nextSibling;return n}function te(e,t,r){var n=new t.constructor;for(var o in t){var a=t[o];"object"!=typeof a&&a!=n[o]&&(n[o]=a)}switch(t.childNodes&&(n.childNodes=new E),n.ownerDocument=e,n.nodeType){case i:var c=t.attributes,u=n.attributes=new O,l=c.length;u._ownerElement=n;for(var h=0;h<l;h++)n.setAttributeNode(te(e,c.item(h),!0));break;case s:r=!0}if(r)for(var p=t.firstChild;p;)n.appendChild(te(e,p,r)),p=p.nextSibling;return n}function re(e,t,r){e[t]=r}_.INVALID_STATE_ERR=(g[11]="Invalid state",11),_.SYNTAX_ERR=(g[12]="Syntax error",12),_.INVALID_MODIFICATION_ERR=(g[13]="Invalid modification",13),_.NAMESPACE_ERR=(g[14]="Invalid namespace",14),_.INVALID_ACCESS_ERR=(g[15]="Invalid access",15),N.prototype=Error.prototype,r(_,N),E.prototype={length:0,item:function(e){return this[e]||null},toString:function(e,t){for(var r=[],n=0;n<this.length;n++)J(this[n],r,e,t);return r.join("")}},C.prototype.item=function(e){return I(this),this[e]},n(C,E),O.prototype={length:0,item:E.prototype.item,getNamedItem:function(e){for(var t=this.length;t--;){var r=this[t];if(r.nodeName==e)return r}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new N(b);var r=this.getNamedItem(e.nodeName);return D(this._ownerElement,this,e,r),r},setNamedItemNS:function(e){var t,r=e.ownerElement;if(r&&r!=this._ownerElement)throw new N(b);return t=this.getNamedItemNS(e.namespaceURI,e.localName),D(this._ownerElement,this,e,t),t},removeNamedItem:function(e){var t=this.getNamedItem(e);return A(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var r=this.getNamedItemNS(e,t);return A(this._ownerElement,this,r),r},getNamedItemNS:function(e,t){for(var r=this.length;r--;){var n=this[r];if(n.localName==t&&n.namespaceURI==e)return n}return null}},T.prototype={hasFeature:function(e,t){var r=this._features[e.toLowerCase()];return!(!r||t&&!(t in r))},createDocument:function(e,t,r){var n=new F;if(n.implementation=this,n.childNodes=new E,n.doctype=r,r&&n.appendChild(r),t){var o=n.createElementNS(e,t);n.appendChild(o)}return n},createDocumentType:function(e,t,r){var n=new G;return n.name=e,n.nodeName=e,n.publicId=t,n.systemId=r,n}},x.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return V(this,e,t)},replaceChild:function(e,t){this.insertBefore(e,t),t&&this.removeChild(t)},removeChild:function(e){return $(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(e){return te(this.ownerDocument||this,this,e)},normalize:function(){for(var e=this.firstChild;e;){var t=e.nextSibling;t&&t.nodeType==a&&e.nodeType==a?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){for(var t=this;t;){var r=t._nsMap;if(r)for(var n in r)if(r[n]==e)return n;t=t.nodeType==s?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){for(var t=this;t;){var r=t._nsMap;if(r&&e in r)return r[e];t=t.nodeType==s?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){return null==this.lookupPrefix(e)}},r(o,x),r(o,x.prototype),F.prototype={nodeName:"#document",nodeType:d,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==m){for(var r=e.firstChild;r;){var n=r.nextSibling;this.insertBefore(r,t),r=n}return e}return null==this.documentElement&&e.nodeType==i&&(this.documentElement=e),V(this,e,t),e.ownerDocument=this,e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),$(this,e)},importNode:function(e,t){return ee(this,e,t)},getElementById:function(e){var t=null;return k(this.documentElement,(function(r){if(r.nodeType==i&&r.getAttribute("id")==e)return t=r,!0})),t},getElementsByClassName:function(e){var t=new RegExp("(^|\\s)"+e+"(\\s|$)");return new C(this,(function(e){var r=[];return k(e.documentElement,(function(n){n!==e&&n.nodeType==i&&t.test(n.getAttribute("class"))&&r.push(n)})),r}))},createElement:function(e){var t=new j;return t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.childNodes=new E,(t.attributes=new O)._ownerElement=t,t},createDocumentFragment:function(){var e=new K;return e.ownerDocument=this,e.childNodes=new E,e},createTextNode:function(e){var t=new B;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new z;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new q;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){var r=new X;return r.ownerDocument=this,r.tagName=r.target=e,r.nodeValue=r.data=t,r},createAttribute:function(e){var t=new U;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new H;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){var r=new j,n=t.split(":"),o=r.attributes=new O;return r.childNodes=new E,r.ownerDocument=this,r.nodeName=t,r.tagName=t,r.namespaceURI=e,2==n.length?(r.prefix=n[0],r.localName=n[1]):r.localName=t,o._ownerElement=r,r},createAttributeNS:function(e,t){var r=new U,n=t.split(":");return r.ownerDocument=this,r.nodeName=t,r.name=t,r.namespaceURI=e,r.specified=!0,2==n.length?(r.prefix=n[0],r.localName=n[1]):r.localName=t,r}},n(F,x),j.prototype={nodeType:i,hasAttribute:function(e){return null!=this.getAttributeNode(e)},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var r=this.ownerDocument.createAttribute(e);r.value=r.nodeValue=""+t,this.setAttributeNode(r)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===m?this.insertBefore(e,null):function(e,t){var r=t.parentNode;if(r){var n=e.lastChild;r.removeChild(t),n=e.lastChild}return n=e.lastChild,t.parentNode=e,t.previousSibling=n,t.nextSibling=null,n?n.nextSibling=t:e.firstChild=t,e.lastChild=t,R(e.ownerDocument,e,t),t}(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var r=this.getAttributeNodeNS(e,t);r&&this.removeAttributeNode(r)},hasAttributeNS:function(e,t){return null!=this.getAttributeNodeNS(e,t)},getAttributeNS:function(e,t){var r=this.getAttributeNodeNS(e,t);return r&&r.value||""},setAttributeNS:function(e,t,r){var n=this.ownerDocument.createAttributeNS(e,t);n.value=n.nodeValue=""+r,this.setAttributeNode(n)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new C(this,(function(t){var r=[];return k(t,(function(n){n===t||n.nodeType!=i||"*"!==e&&n.tagName!=e||r.push(n)})),r}))},getElementsByTagNameNS:function(e,t){return new C(this,(function(r){var n=[];return k(r,(function(o){o===r||o.nodeType!==i||"*"!==e&&o.namespaceURI!==e||"*"!==t&&o.localName!=t||n.push(o)})),n}))}},F.prototype.getElementsByTagName=j.prototype.getElementsByTagName,F.prototype.getElementsByTagNameNS=j.prototype.getElementsByTagNameNS,n(j,x),U.prototype.nodeType=s,n(U,x),M.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(g[v])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,r){r=this.data.substring(0,e)+r+this.data.substring(e+t),this.nodeValue=this.data=r,this.length=r.length}},n(M,x),B.prototype={nodeName:"#text",nodeType:a,splitText:function(e){var t=this.data,r=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var n=this.ownerDocument.createTextNode(r);return this.parentNode&&this.parentNode.insertBefore(n,this.nextSibling),n}},n(B,M),z.prototype={nodeName:"#comment",nodeType:p},n(z,M),q.prototype={nodeName:"#cdata-section",nodeType:c},n(q,M),G.prototype.nodeType=f,n(G,x),W.prototype.nodeType=y,n(W,x),Y.prototype.nodeType=l,n(Y,x),H.prototype.nodeType=u,n(H,x),K.prototype.nodeName="#document-fragment",K.prototype.nodeType=m,n(K,x),X.prototype.nodeType=h,n(X,x),x.prototype.toString=Z;try{if(Object.defineProperty){function ne(e){switch(e.nodeType){case i:case m:var t=[];for(e=e.firstChild;e;)7!==e.nodeType&&8!==e.nodeType&&t.push(ne(e)),e=e.nextSibling;return t.join("");default:return e.nodeValue}}Object.defineProperty(C.prototype,"length",{get:function(){return I(this),this.$$length}}),Object.defineProperty(x.prototype,"textContent",{get:function(){return ne(this)},set:function(e){switch(this.nodeType){case i:case m:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),re=function(e,t,r){e["$$"+t]=r}}}catch(oe){}t.DOMImplementation=T},444:(e,t)=>{t.entityMap={lt:"<",gt:">",amp:"&",quot:'"',apos:"'",Agrave:"À",Aacute:"Á",Acirc:"Â",Atilde:"Ã",Auml:"Ä",Aring:"Å",AElig:"Æ",Ccedil:"Ç",Egrave:"È",Eacute:"É",Ecirc:"Ê",Euml:"Ë",Igrave:"Ì",Iacute:"Í",Icirc:"Î",Iuml:"Ï",ETH:"Ð",Ntilde:"Ñ",Ograve:"Ò",Oacute:"Ó",Ocirc:"Ô",Otilde:"Õ",Ouml:"Ö",Oslash:"Ø",Ugrave:"Ù",Uacute:"Ú",Ucirc:"Û",Uuml:"Ü",Yacute:"Ý",THORN:"Þ",szlig:"ß",agrave:"à",aacute:"á",acirc:"â",atilde:"ã",auml:"ä",aring:"å",aelig:"æ",ccedil:"ç",egrave:"è",eacute:"é",ecirc:"ê",euml:"ë",igrave:"ì",iacute:"í",icirc:"î",iuml:"ï",eth:"ð",ntilde:"ñ",ograve:"ò",oacute:"ó",ocirc:"ô",otilde:"õ",ouml:"ö",oslash:"ø",ugrave:"ù",uacute:"ú",ucirc:"û",uuml:"ü",yacute:"ý",thorn:"þ",yuml:"ÿ",nbsp:" ",iexcl:"¡",cent:"¢",pound:"£",curren:"¤",yen:"¥",brvbar:"¦",sect:"§",uml:"¨",copy:"©",ordf:"ª",laquo:"«",not:"¬",shy:"­­",reg:"®",macr:"¯",deg:"°",plusmn:"±",sup2:"²",sup3:"³",acute:"´",micro:"µ",para:"¶",middot:"·",cedil:"¸",sup1:"¹",ordm:"º",raquo:"»",frac14:"¼",frac12:"½",frac34:"¾",iquest:"¿",times:"×",divide:"÷",forall:"∀",part:"∂",exist:"∃",empty:"∅",nabla:"∇",isin:"∈",notin:"∉",ni:"∋",prod:"∏",sum:"∑",minus:"−",lowast:"∗",radic:"√",prop:"∝",infin:"∞",ang:"∠",and:"∧",or:"∨",cap:"∩",cup:"∪",int:"∫",there4:"∴",sim:"∼",cong:"≅",asymp:"≈",ne:"≠",equiv:"≡",le:"≤",ge:"≥",sub:"⊂",sup:"⊃",nsub:"⊄",sube:"⊆",supe:"⊇",oplus:"⊕",otimes:"⊗",perp:"⊥",sdot:"⋅",Alpha:"Α",Beta:"Β",Gamma:"Γ",Delta:"Δ",Epsilon:"Ε",Zeta:"Ζ",Eta:"Η",Theta:"Θ",Iota:"Ι",Kappa:"Κ",Lambda:"Λ",Mu:"Μ",Nu:"Ν",Xi:"Ξ",Omicron:"Ο",Pi:"Π",Rho:"Ρ",Sigma:"Σ",Tau:"Τ",Upsilon:"Υ",Phi:"Φ",Chi:"Χ",Psi:"Ψ",Omega:"Ω",alpha:"α",beta:"β",gamma:"γ",delta:"δ",epsilon:"ε",zeta:"ζ",eta:"η",theta:"θ",iota:"ι",kappa:"κ",lambda:"λ",mu:"μ",nu:"ν",xi:"ξ",omicron:"ο",pi:"π",rho:"ρ",sigmaf:"ς",sigma:"σ",tau:"τ",upsilon:"υ",phi:"φ",chi:"χ",psi:"ψ",omega:"ω",thetasym:"ϑ",upsih:"ϒ",piv:"ϖ",OElig:"Œ",oelig:"œ",Scaron:"Š",scaron:"š",Yuml:"Ÿ",fnof:"ƒ",circ:"ˆ",tilde:"˜",ensp:" ",emsp:" ",thinsp:" ",zwnj:"‌",zwj:"‍",lrm:"‎",rlm:"‏",ndash:"–",mdash:"—",lsquo:"‘",rsquo:"’",sbquo:"‚",ldquo:"“",rdquo:"”",bdquo:"„",dagger:"†",Dagger:"‡",bull:"•",hellip:"…",permil:"‰",prime:"′",Prime:"″",lsaquo:"‹",rsaquo:"›",oline:"‾",euro:"€",trade:"™",larr:"←",uarr:"↑",rarr:"→",darr:"↓",harr:"↔",crarr:"↵",lceil:"⌈",rceil:"⌉",lfloor:"⌊",rfloor:"⌋",loz:"◊",spades:"♠",clubs:"♣",hearts:"♥",diams:"♦"}},552:(e,t)=>{var r=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,n=new RegExp("[\\-\\.0-9"+r.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),o=new RegExp("^"+r.source+n.source+"*(?::"+r.source+n.source+"*)?$");function i(e,t){this.message=e,this.locator=t,Error.captureStackTrace&&Error.captureStackTrace(this,i)}function s(){}function a(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function c(e,t,r,n,o,i){function s(e,t,n){e in r.attributeNames&&i.fatalError("Attribute "+e+" redefined"),r.addValue(e,t,n)}for(var a,c=++t,u=0;;){var l=e.charAt(c);switch(l){case"=":if(1===u)a=e.slice(t,c),u=3;else{if(2!==u)throw new Error("attribute equal must after attrName");u=3}break;case"'":case'"':if(3===u||1===u){if(1===u&&(i.warning('attribute value must after "="'),a=e.slice(t,c)),t=c+1,!((c=e.indexOf(l,t))>0))throw new Error("attribute value no end '"+l+"' match");s(a,h=e.slice(t,c).replace(/&#?\w+;/g,o),t-1),u=5}else{if(4!=u)throw new Error('attribute value must after "="');s(a,h=e.slice(t,c).replace(/&#?\w+;/g,o),t),i.warning('attribute "'+a+'" missed start quot('+l+")!!"),t=c+1,u=5}break;case"/":switch(u){case 0:r.setTagName(e.slice(t,c));case 5:case 6:case 7:u=7,r.closed=!0;case 4:case 1:case 2:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return i.error("unexpected end of input"),0==u&&r.setTagName(e.slice(t,c)),c;case">":switch(u){case 0:r.setTagName(e.slice(t,c));case 5:case 6:case 7:break;case 4:case 1:"/"===(h=e.slice(t,c)).slice(-1)&&(r.closed=!0,h=h.slice(0,-1));case 2:2===u&&(h=a),4==u?(i.warning('attribute "'+h+'" missed quot(")!'),s(a,h.replace(/&#?\w+;/g,o),t)):("http://www.w3.org/1999/xhtml"===n[""]&&h.match(/^(?:disabled|checked|selected)$/i)||i.warning('attribute "'+h+'" missed value!! "'+h+'" instead!!'),s(h,h,t));break;case 3:throw new Error("attribute value missed!!")}return c;case"":l=" ";default:if(l<=" ")switch(u){case 0:r.setTagName(e.slice(t,c)),u=6;break;case 1:a=e.slice(t,c),u=2;break;case 4:var h=e.slice(t,c).replace(/&#?\w+;/g,o);i.warning('attribute "'+h+'" missed quot(")!!'),s(a,h,t);case 5:u=6}else switch(u){case 2:r.tagName,"http://www.w3.org/1999/xhtml"===n[""]&&a.match(/^(?:disabled|checked|selected)$/i)||i.warning('attribute "'+a+'" missed value!! "'+a+'" instead2!!'),s(a,a,t),t=c,u=1;break;case 5:i.warning('attribute space is required"'+a+'"!!');case 6:u=1,t=c;break;case 3:u=4,t=c;break;case 7:throw new Error("elements closed character '/' and '>' must be connected to")}}c++}}function u(e,t,r){for(var n=e.tagName,o=null,i=e.length;i--;){var s=e[i],a=s.qName,c=s.value;if((d=a.indexOf(":"))>0)var u=s.prefix=a.slice(0,d),l=a.slice(d+1),h="xmlns"===u&&l;else l=a,u=null,h="xmlns"===a&&"";s.localName=l,!1!==h&&(null==o&&(o={},p(r,r={})),r[h]=o[h]=c,s.uri="http://www.w3.org/2000/xmlns/",t.startPrefixMapping(h,c))}for(i=e.length;i--;)(u=(s=e[i]).prefix)&&("xml"===u&&(s.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==u&&(s.uri=r[u||""]));var d;(d=n.indexOf(":"))>0?(u=e.prefix=n.slice(0,d),l=e.localName=n.slice(d+1)):(u=null,l=e.localName=n);var f=e.uri=r[u||""];if(t.startElement(f,l,n,e),!e.closed)return e.currentNSMap=r,e.localNSMap=o,!0;if(t.endElement(f,l,n),o)for(u in o)t.endPrefixMapping(u)}function l(e,t,r,n,o){if(/^(?:script|textarea)$/i.test(r)){var i=e.indexOf("</"+r+">",t),s=e.substring(t+1,i);if(/[&<]/.test(s))return/^script$/i.test(r)?(o.characters(s,0,s.length),i):(s=s.replace(/&#?\w+;/g,n),o.characters(s,0,s.length),i)}return t+1}function h(e,t,r,n){var o=n[r];return null==o&&((o=e.lastIndexOf("</"+r+">"))<t&&(o=e.lastIndexOf("</"+r)),n[r]=o),o<t}function p(e,t){for(var r in e)t[r]=e[r]}function d(e,t,r,n){if("-"===e.charAt(t+2))return"-"===e.charAt(t+3)?(o=e.indexOf("--\x3e",t+4))>t?(r.comment(e,t+4,o-t-4),o+3):(n.error("Unclosed comment"),-1):-1;if("CDATA["==e.substr(t+3,6)){var o=e.indexOf("]]>",t+9);return r.startCDATA(),r.characters(e,t+9,o-t-9),r.endCDATA(),o+3}var i=function(e,t){var r,n=[],o=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(o.lastIndex=t,o.exec(e);r=o.exec(e);)if(n.push(r),r[1])return n}(e,t),s=i.length;if(s>1&&/!doctype/i.test(i[0][0])){var a=i[1][0],c=!1,u=!1;s>3&&(/^public$/i.test(i[2][0])?(c=i[3][0],u=s>4&&i[4][0]):/^system$/i.test(i[2][0])&&(u=i[3][0]));var l=i[s-1];return r.startDTD(a,c,u),r.endDTD(),l.index+l[0].length}return-1}function f(e,t,r){var n=e.indexOf("?>",t);if(n){var o=e.substring(t,n).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return o?(o[0].length,r.processingInstruction(o[1],o[2]),n+2):-1}return-1}function m(){this.attributeNames={}}i.prototype=new Error,i.prototype.name=i.name,s.prototype={parse:function(e,t,r){var n=this.domBuilder;n.startDocument(),p(t,t={}),function(e,t,r,n,o){function s(e){var t=e.slice(1,-1);return t in r?r[t]:"#"===t.charAt(0)?function(e){if(e>65535){var t=55296+((e-=65536)>>10),r=56320+(1023&e);return String.fromCharCode(t,r)}return String.fromCharCode(e)}(parseInt(t.substr(1).replace("x","0x"))):(o.error("entity not found:"+e),e)}function p(t){if(t>E){var r=e.substring(E,t).replace(/&#?\w+;/g,s);w&&y(E),n.characters(r,0,t-E),E=t}}function y(t,r){for(;t>=g&&(r=v.exec(e));)_=r.index,g=_+r[0].length,w.lineNumber++;w.columnNumber=t-_+1}for(var _=0,g=0,v=/.*(?:\r\n?|\n)|.*$/g,w=n.locator,b=[{currentNSMap:t}],N={},E=0;;){try{var C=e.indexOf("<",E);if(C<0){if(!e.substr(E).match(/^\s*$/)){var I=n.doc,O=I.createTextNode(e.substr(E));I.appendChild(O),n.currentElement=O}return}switch(C>E&&p(C),e.charAt(C+1)){case"/":var S=e.indexOf(">",C+3),D=e.substring(C+2,S),A=b.pop();S<0?(D=e.substring(C+2).replace(/[\s<].*/,""),o.error("end tag name: "+D+" is not complete:"+A.tagName),S=C+1+D.length):D.match(/\s</)&&(D=D.replace(/[\s<].*/,""),o.error("end tag name: "+D+" maybe not complete"),S=C+1+D.length);var T=A.localNSMap,x=A.tagName==D;if(x||A.tagName&&A.tagName.toLowerCase()==D.toLowerCase()){if(n.endElement(A.uri,A.localName,D),T)for(var P in T)n.endPrefixMapping(P);x||o.fatalError("end tag name: "+D+" is not match the current start tagName:"+A.tagName)}else b.push(A);S++;break;case"?":w&&y(C),S=f(e,C,n);break;case"!":w&&y(C),S=d(e,C,n,o);break;default:w&&y(C);var k=new m,F=b[b.length-1].currentNSMap,L=(S=c(e,C,k,F,s,o),k.length);if(!k.closed&&h(e,S,k.tagName,N)&&(k.closed=!0,r.nbsp||o.warning("unclosed xml attribute")),w&&L){for(var R=a(w,{}),$=0;$<L;$++){var V=k[$];y(V.offset),V.locator=a(w,{})}n.locator=R,u(k,n,F)&&b.push(k),n.locator=w}else u(k,n,F)&&b.push(k);"http://www.w3.org/1999/xhtml"!==k.uri||k.closed?S++:S=l(e,S,k.tagName,s,n)}}catch(e){if(e instanceof i)throw e;o.error("element parse error: "+e),S=-1}S>E?E=S:p(Math.max(C,E)+1)}}(e,t,r,n,this.errorHandler),n.endDocument()}},m.prototype={setTagName:function(e){if(!o.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},addValue:function(e,t,r){if(!o.test(e))throw new Error("invalid attribute:"+e);this.attributeNames[e]=this.length,this[this.length++]={qName:e,value:t,offset:r}},length:0,getLocalName:function(e){return this[e].localName},getLocator:function(e){return this[e].locator},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},t.XMLReader=s,t.ParseError=i},369:function(e){(function(){var t,r,n,o,i,s,a=[].slice,c={}.hasOwnProperty;t=function(){var e,t,r,n,i,s;if(s=arguments[0],i=2<=arguments.length?a.call(arguments,1):[],o(Object.assign))Object.assign.apply(null,arguments);else for(e=0,r=i.length;e<r;e++)if(null!=(n=i[e]))for(t in n)c.call(n,t)&&(s[t]=n[t]);return s},o=function(e){return!!e&&"[object Function]"===Object.prototype.toString.call(e)},i=function(e){var t;return!!e&&("function"==(t=typeof e)||"object"===t)},r=function(e){return o(Array.isArray)?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)},n=function(e){var t;if(r(e))return!e.length;for(t in e)if(c.call(e,t))return!1;return!0},s=function(e){var t,r;return i(e)&&(r=Object.getPrototypeOf(e))&&(t=r.constructor)&&"function"==typeof t&&t instanceof t&&Function.prototype.toString.call(t)===Function.prototype.toString.call(Object)},e.exports.assign=t,e.exports.isFunction=o,e.exports.isObject=i,e.exports.isArray=r,e.exports.isEmpty=n,e.exports.isPlainObject=s}).call(this)},750:function(e){(function(){e.exports=function(){function e(e,t,r){if(this.options=e.options,this.stringify=e.stringify,null==t)throw new Error("Missing attribute name of element "+e.name);if(null==r)throw new Error("Missing attribute value for attribute "+t+" of element "+e.name);this.name=this.stringify.attName(t),this.value=this.stringify.attValue(r)}return e.prototype.clone=function(){return Object.create(this)},e.prototype.toString=function(e){return this.options.writer.set(e).attribute(this)},e}()}).call(this)},170:function(e,t,r){(function(){var t,n={}.hasOwnProperty;t=r(26),e.exports=function(e){function t(e,r){if(t.__super__.constructor.call(this,e),null==r)throw new Error("Missing CDATA text");this.text=this.stringify.cdata(r)}return function(e,t){for(var r in t)n.call(t,r)&&(e[r]=t[r]);function o(){this.constructor=e}o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype}(t,e),t.prototype.clone=function(){return Object.create(this)},t.prototype.toString=function(e){return this.options.writer.set(e).cdata(this)},t}(t)}).call(this)},96:function(e,t,r){(function(){var t,n={}.hasOwnProperty;t=r(26),e.exports=function(e){function t(e,r){if(t.__super__.constructor.call(this,e),null==r)throw new Error("Missing comment text");this.text=this.stringify.comment(r)}return function(e,t){for(var r in t)n.call(t,r)&&(e[r]=t[r]);function o(){this.constructor=e}o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype}(t,e),t.prototype.clone=function(){return Object.create(this)},t.prototype.toString=function(e){return this.options.writer.set(e).comment(this)},t}(t)}).call(this)},179:function(e,t,r){(function(){var t,n={}.hasOwnProperty;t=r(26),e.exports=function(e){function t(e,r,n,o,i,s){if(t.__super__.constructor.call(this,e),null==r)throw new Error("Missing DTD element name");if(null==n)throw new Error("Missing DTD attribute name");if(!o)throw new Error("Missing DTD attribute type");if(!i)throw new Error("Missing DTD attribute default");if(0!==i.indexOf("#")&&(i="#"+i),!i.match(/^(#REQUIRED|#IMPLIED|#FIXED|#DEFAULT)$/))throw new Error("Invalid default value type; expected: #REQUIRED, #IMPLIED, #FIXED or #DEFAULT");if(s&&!i.match(/^(#FIXED|#DEFAULT)$/))throw new Error("Default value only applies to #FIXED or #DEFAULT");this.elementName=this.stringify.eleName(r),this.attributeName=this.stringify.attName(n),this.attributeType=this.stringify.dtdAttType(o),this.defaultValue=this.stringify.dtdAttDefault(s),this.defaultValueType=i}return function(e,t){for(var r in t)n.call(t,r)&&(e[r]=t[r]);function o(){this.constructor=e}o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype}(t,e),t.prototype.toString=function(e){return this.options.writer.set(e).dtdAttList(this)},t}(t)}).call(this)},347:function(e,t,r){(function(){var t,n={}.hasOwnProperty;t=r(26),e.exports=function(e){function t(e,r,n){if(t.__super__.constructor.call(this,e),null==r)throw new Error("Missing DTD element name");n||(n="(#PCDATA)"),Array.isArray(n)&&(n="("+n.join(",")+")"),this.name=this.stringify.eleName(r),this.value=this.stringify.dtdElementValue(n)}return function(e,t){for(var r in t)n.call(t,r)&&(e[r]=t[r]);function o(){this.constructor=e}o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype}(t,e),t.prototype.toString=function(e){return this.options.writer.set(e).dtdElement(this)},t}(t)}).call(this)},580:function(e,t,r){(function(){var t,n,o={}.hasOwnProperty;n=r(369).isObject,t=r(26),e.exports=function(e){function t(e,r,o,i){if(t.__super__.constructor.call(this,e),null==o)throw new Error("Missing entity name");if(null==i)throw new Error("Missing entity value");if(this.pe=!!r,this.name=this.stringify.eleName(o),n(i)){if(!i.pubID&&!i.sysID)throw new Error("Public and/or system identifiers are required for an external entity");if(i.pubID&&!i.sysID)throw new Error("System identifier is required for a public external entity");if(null!=i.pubID&&(this.pubID=this.stringify.dtdPubID(i.pubID)),null!=i.sysID&&(this.sysID=this.stringify.dtdSysID(i.sysID)),null!=i.nData&&(this.nData=this.stringify.dtdNData(i.nData)),this.pe&&this.nData)throw new Error("Notation declaration is not allowed in a parameter entity")}else this.value=this.stringify.dtdEntityValue(i)}return function(e,t){for(var r in t)o.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(t,e),t.prototype.toString=function(e){return this.options.writer.set(e).dtdEntity(this)},t}(t)}).call(this)},777:function(e,t,r){(function(){var t,n={}.hasOwnProperty;t=r(26),e.exports=function(e){function t(e,r,n){if(t.__super__.constructor.call(this,e),null==r)throw new Error("Missing notation name");if(!n.pubID&&!n.sysID)throw new Error("Public or system identifiers are required for an external entity");this.name=this.stringify.eleName(r),null!=n.pubID&&(this.pubID=this.stringify.dtdPubID(n.pubID)),null!=n.sysID&&(this.sysID=this.stringify.dtdSysID(n.sysID))}return function(e,t){for(var r in t)n.call(t,r)&&(e[r]=t[r]);function o(){this.constructor=e}o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype}(t,e),t.prototype.toString=function(e){return this.options.writer.set(e).dtdNotation(this)},t}(t)}).call(this)},77:function(e,t,r){(function(){var t,n,o={}.hasOwnProperty;n=r(369).isObject,t=r(26),e.exports=function(e){function t(e,r,o,i){var s;t.__super__.constructor.call(this,e),n(r)&&(r=(s=r).version,o=s.encoding,i=s.standalone),r||(r="1.0"),this.version=this.stringify.xmlVersion(r),null!=o&&(this.encoding=this.stringify.xmlEncoding(o)),null!=i&&(this.standalone=this.stringify.xmlStandalone(i))}return function(e,t){for(var r in t)o.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(t,e),t.prototype.toString=function(e){return this.options.writer.set(e).declaration(this)},t}(t)}).call(this)},544:function(e,t,r){(function(){var t,n,o,i,s,a,c={}.hasOwnProperty;a=r(369).isObject,s=r(26),t=r(179),o=r(580),n=r(347),i=r(777),e.exports=function(e){function r(e,t,n){var o,i;r.__super__.constructor.call(this,e),this.documentObject=e,a(t)&&(t=(o=t).pubID,n=o.sysID),null==n&&(n=(i=[t,n])[0],t=i[1]),null!=t&&(this.pubID=this.stringify.dtdPubID(t)),null!=n&&(this.sysID=this.stringify.dtdSysID(n))}return function(e,t){for(var r in t)c.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(r,e),r.prototype.element=function(e,t){var r;return r=new n(this,e,t),this.children.push(r),this},r.prototype.attList=function(e,r,n,o,i){var s;return s=new t(this,e,r,n,o,i),this.children.push(s),this},r.prototype.entity=function(e,t){var r;return r=new o(this,!1,e,t),this.children.push(r),this},r.prototype.pEntity=function(e,t){var r;return r=new o(this,!0,e,t),this.children.push(r),this},r.prototype.notation=function(e,t){var r;return r=new i(this,e,t),this.children.push(r),this},r.prototype.toString=function(e){return this.options.writer.set(e).docType(this)},r.prototype.ele=function(e,t){return this.element(e,t)},r.prototype.att=function(e,t,r,n,o){return this.attList(e,t,r,n,o)},r.prototype.ent=function(e,t){return this.entity(e,t)},r.prototype.pent=function(e,t){return this.pEntity(e,t)},r.prototype.not=function(e,t){return this.notation(e,t)},r.prototype.up=function(){return this.root()||this.documentObject},r}(s)}).call(this)},934:function(e,t,r){(function(){var t,n,o,i,s={}.hasOwnProperty;i=r(369).isPlainObject,t=r(26),o=r(549),n=r(434),e.exports=function(e){function t(e){t.__super__.constructor.call(this,null),e||(e={}),e.writer||(e.writer=new n),this.options=e,this.stringify=new o(e),this.isDocument=!0}return function(e,t){for(var r in t)s.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(t,e),t.prototype.end=function(e){var t;return e?i(e)&&(t=e,e=this.options.writer.set(t)):e=this.options.writer,e.document(this)},t.prototype.toString=function(e){return this.options.writer.set(e).document(this)},t}(t)}).call(this)},505:function(e,t,r){(function(){var t,n,o,i,s,a,c,u,l,h,p,d,f,m,y,_,g,v,w,b={}.hasOwnProperty;w=r(369),g=w.isObject,_=w.isFunction,v=w.isPlainObject,h=r(161),n=r(170),o=r(96),d=r(406),y=r(595),p=r(181),u=r(77),l=r(544),i=r(179),a=r(580),s=r(347),c=r(777),t=r(750),m=r(549),f=r(434),e.exports=function(){function e(e,t,r){var n;e||(e={}),e.writer?v(e.writer)&&(n=e.writer,e.writer=new f(n)):e.writer=new f(e),this.options=e,this.writer=e.writer,this.stringify=new m(e),this.onDataCallback=t||function(){},this.onEndCallback=r||function(){},this.currentNode=null,this.currentLevel=-1,this.openTags={},this.documentStarted=!1,this.documentCompleted=!1,this.root=null}return e.prototype.node=function(e,t,r){var n;if(null==e)throw new Error("Missing node name");if(this.root&&-1===this.currentLevel)throw new Error("Document can only have one root node");return this.openCurrent(),e=e.valueOf(),null==t&&(t={}),t=t.valueOf(),g(t)||(r=(n=[t,r])[0],t=n[1]),this.currentNode=new h(this,e,t),this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,null!=r&&this.text(r),this},e.prototype.element=function(e,t,r){return this.currentNode&&this.currentNode instanceof l?this.dtdElement.apply(this,arguments):this.node(e,t,r)},e.prototype.attribute=function(e,r){var n,o;if(!this.currentNode||this.currentNode.children)throw new Error("att() can only be used immediately after an ele() call in callback mode");if(null!=e&&(e=e.valueOf()),g(e))for(n in e)b.call(e,n)&&(o=e[n],this.attribute(n,o));else _(r)&&(r=r.apply()),this.options.skipNullAttributes&&null==r||(this.currentNode.attributes[e]=new t(this,e,r));return this},e.prototype.text=function(e){var t;return this.openCurrent(),t=new y(this,e),this.onData(this.writer.text(t,this.currentLevel+1)),this},e.prototype.cdata=function(e){var t;return this.openCurrent(),t=new n(this,e),this.onData(this.writer.cdata(t,this.currentLevel+1)),this},e.prototype.comment=function(e){var t;return this.openCurrent(),t=new o(this,e),this.onData(this.writer.comment(t,this.currentLevel+1)),this},e.prototype.raw=function(e){var t;return this.openCurrent(),t=new d(this,e),this.onData(this.writer.raw(t,this.currentLevel+1)),this},e.prototype.instruction=function(e,t){var r,n,o,i,s;if(this.openCurrent(),null!=e&&(e=e.valueOf()),null!=t&&(t=t.valueOf()),Array.isArray(e))for(r=0,i=e.length;r<i;r++)n=e[r],this.instruction(n);else if(g(e))for(n in e)b.call(e,n)&&(o=e[n],this.instruction(n,o));else _(t)&&(t=t.apply()),s=new p(this,e,t),this.onData(this.writer.processingInstruction(s,this.currentLevel+1));return this},e.prototype.declaration=function(e,t,r){var n;if(this.openCurrent(),this.documentStarted)throw new Error("declaration() must be the first node");return n=new u(this,e,t,r),this.onData(this.writer.declaration(n,this.currentLevel+1)),this},e.prototype.doctype=function(e,t,r){if(this.openCurrent(),null==e)throw new Error("Missing root node name");if(this.root)throw new Error("dtd() must come before the root node");return this.currentNode=new l(this,t,r),this.currentNode.rootNodeName=e,this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,this},e.prototype.dtdElement=function(e,t){var r;return this.openCurrent(),r=new s(this,e,t),this.onData(this.writer.dtdElement(r,this.currentLevel+1)),this},e.prototype.attList=function(e,t,r,n,o){var s;return this.openCurrent(),s=new i(this,e,t,r,n,o),this.onData(this.writer.dtdAttList(s,this.currentLevel+1)),this},e.prototype.entity=function(e,t){var r;return this.openCurrent(),r=new a(this,!1,e,t),this.onData(this.writer.dtdEntity(r,this.currentLevel+1)),this},e.prototype.pEntity=function(e,t){var r;return this.openCurrent(),r=new a(this,!0,e,t),this.onData(this.writer.dtdEntity(r,this.currentLevel+1)),this},e.prototype.notation=function(e,t){var r;return this.openCurrent(),r=new c(this,e,t),this.onData(this.writer.dtdNotation(r,this.currentLevel+1)),this},e.prototype.up=function(){if(this.currentLevel<0)throw new Error("The document node has no parent");return this.currentNode?(this.currentNode.children?this.closeNode(this.currentNode):this.openNode(this.currentNode),this.currentNode=null):this.closeNode(this.openTags[this.currentLevel]),delete this.openTags[this.currentLevel],this.currentLevel--,this},e.prototype.end=function(){for(;this.currentLevel>=0;)this.up();return this.onEnd()},e.prototype.openCurrent=function(){if(this.currentNode)return this.currentNode.children=!0,this.openNode(this.currentNode)},e.prototype.openNode=function(e){if(!e.isOpen)return!this.root&&0===this.currentLevel&&e instanceof h&&(this.root=e),this.onData(this.writer.openNode(e,this.currentLevel)),e.isOpen=!0},e.prototype.closeNode=function(e){if(!e.isClosed)return this.onData(this.writer.closeNode(e,this.currentLevel)),e.isClosed=!0},e.prototype.onData=function(e){return this.documentStarted=!0,this.onDataCallback(e)},e.prototype.onEnd=function(){return this.documentCompleted=!0,this.onEndCallback()},e.prototype.ele=function(){return this.element.apply(this,arguments)},e.prototype.nod=function(e,t,r){return this.node(e,t,r)},e.prototype.txt=function(e){return this.text(e)},e.prototype.dat=function(e){return this.cdata(e)},e.prototype.com=function(e){return this.comment(e)},e.prototype.ins=function(e,t){return this.instruction(e,t)},e.prototype.dec=function(e,t,r){return this.declaration(e,t,r)},e.prototype.dtd=function(e,t,r){return this.doctype(e,t,r)},e.prototype.e=function(e,t,r){return this.element(e,t,r)},e.prototype.n=function(e,t,r){return this.node(e,t,r)},e.prototype.t=function(e){return this.text(e)},e.prototype.d=function(e){return this.cdata(e)},e.prototype.c=function(e){return this.comment(e)},e.prototype.r=function(e){return this.raw(e)},e.prototype.i=function(e,t){return this.instruction(e,t)},e.prototype.att=function(){return this.currentNode&&this.currentNode instanceof l?this.attList.apply(this,arguments):this.attribute.apply(this,arguments)},e.prototype.a=function(){return this.currentNode&&this.currentNode instanceof l?this.attList.apply(this,arguments):this.attribute.apply(this,arguments)},e.prototype.ent=function(e,t){return this.entity(e,t)},e.prototype.pent=function(e,t){return this.pEntity(e,t)},e.prototype.not=function(e,t){return this.notation(e,t)},e}()}).call(this)},161:function(e,t,r){(function(){var t,n,o,i,s,a={}.hasOwnProperty;s=r(369),i=s.isObject,o=s.isFunction,n=r(26),t=r(750),e.exports=function(e){function r(e,t,n){if(r.__super__.constructor.call(this,e),null==t)throw new Error("Missing element name");this.name=this.stringify.eleName(t),this.attributes={},null!=n&&this.attribute(n),e.isDocument&&(this.isRoot=!0,this.documentObject=e,e.rootObject=this)}return function(e,t){for(var r in t)a.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(r,e),r.prototype.clone=function(){var e,t,r,n;for(t in(r=Object.create(this)).isRoot&&(r.documentObject=null),r.attributes={},n=this.attributes)a.call(n,t)&&(e=n[t],r.attributes[t]=e.clone());return r.children=[],this.children.forEach((function(e){var t;return(t=e.clone()).parent=r,r.children.push(t)})),r},r.prototype.attribute=function(e,r){var n,s;if(null!=e&&(e=e.valueOf()),i(e))for(n in e)a.call(e,n)&&(s=e[n],this.attribute(n,s));else o(r)&&(r=r.apply()),this.options.skipNullAttributes&&null==r||(this.attributes[e]=new t(this,e,r));return this},r.prototype.removeAttribute=function(e){var t,r,n;if(null==e)throw new Error("Missing attribute name");if(e=e.valueOf(),Array.isArray(e))for(r=0,n=e.length;r<n;r++)t=e[r],delete this.attributes[t];else delete this.attributes[e];return this},r.prototype.toString=function(e){return this.options.writer.set(e).element(this)},r.prototype.att=function(e,t){return this.attribute(e,t)},r.prototype.a=function(e,t){return this.attribute(e,t)},r}(n)}).call(this)},26:function(e,t,r){(function(){var t,n,o,i,s,a,c,u,l,h,p,d,f={}.hasOwnProperty;d=r(369),p=d.isObject,h=d.isFunction,l=d.isEmpty,s=null,t=null,n=null,o=null,i=null,c=null,u=null,a=null,e.exports=function(){function e(e){this.parent=e,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),this.children=[],s||(s=r(161),t=r(170),n=r(96),o=r(77),i=r(544),c=r(406),u=r(595),a=r(181))}return e.prototype.element=function(e,t,r){var n,o,i,s,a,c,u,d,m,y;if(c=null,null==t&&(t={}),t=t.valueOf(),p(t)||(r=(m=[t,r])[0],t=m[1]),null!=e&&(e=e.valueOf()),Array.isArray(e))for(i=0,u=e.length;i<u;i++)o=e[i],c=this.element(o);else if(h(e))c=this.element(e.apply());else if(p(e)){for(a in e)if(f.call(e,a))if(y=e[a],h(y)&&(y=y.apply()),p(y)&&l(y)&&(y=null),!this.options.ignoreDecorators&&this.stringify.convertAttKey&&0===a.indexOf(this.stringify.convertAttKey))c=this.attribute(a.substr(this.stringify.convertAttKey.length),y);else if(!this.options.separateArrayItems&&Array.isArray(y))for(s=0,d=y.length;s<d;s++)o=y[s],(n={})[a]=o,c=this.element(n);else p(y)?(c=this.element(a)).element(y):c=this.element(a,y)}else c=!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===e.indexOf(this.stringify.convertTextKey)?this.text(r):!this.options.ignoreDecorators&&this.stringify.convertCDataKey&&0===e.indexOf(this.stringify.convertCDataKey)?this.cdata(r):!this.options.ignoreDecorators&&this.stringify.convertCommentKey&&0===e.indexOf(this.stringify.convertCommentKey)?this.comment(r):!this.options.ignoreDecorators&&this.stringify.convertRawKey&&0===e.indexOf(this.stringify.convertRawKey)?this.raw(r):!this.options.ignoreDecorators&&this.stringify.convertPIKey&&0===e.indexOf(this.stringify.convertPIKey)?this.instruction(e.substr(this.stringify.convertPIKey.length),r):this.node(e,t,r);if(null==c)throw new Error("Could not create any elements with: "+e);return c},e.prototype.insertBefore=function(e,t,r){var n,o,i;if(this.isRoot)throw new Error("Cannot insert elements at root level");return o=this.parent.children.indexOf(this),i=this.parent.children.splice(o),n=this.parent.element(e,t,r),Array.prototype.push.apply(this.parent.children,i),n},e.prototype.insertAfter=function(e,t,r){var n,o,i;if(this.isRoot)throw new Error("Cannot insert elements at root level");return o=this.parent.children.indexOf(this),i=this.parent.children.splice(o+1),n=this.parent.element(e,t,r),Array.prototype.push.apply(this.parent.children,i),n},e.prototype.remove=function(){var e;if(this.isRoot)throw new Error("Cannot remove the root element");return e=this.parent.children.indexOf(this),[].splice.apply(this.parent.children,[e,e-e+1].concat([])),this.parent},e.prototype.node=function(e,t,r){var n,o;return null!=e&&(e=e.valueOf()),t||(t={}),t=t.valueOf(),p(t)||(r=(o=[t,r])[0],t=o[1]),n=new s(this,e,t),null!=r&&n.text(r),this.children.push(n),n},e.prototype.text=function(e){var t;return t=new u(this,e),this.children.push(t),this},e.prototype.cdata=function(e){var r;return r=new t(this,e),this.children.push(r),this},e.prototype.comment=function(e){var t;return t=new n(this,e),this.children.push(t),this},e.prototype.commentBefore=function(e){var t,r;return t=this.parent.children.indexOf(this),r=this.parent.children.splice(t),this.parent.comment(e),Array.prototype.push.apply(this.parent.children,r),this},e.prototype.commentAfter=function(e){var t,r;return t=this.parent.children.indexOf(this),r=this.parent.children.splice(t+1),this.parent.comment(e),Array.prototype.push.apply(this.parent.children,r),this},e.prototype.raw=function(e){var t;return t=new c(this,e),this.children.push(t),this},e.prototype.instruction=function(e,t){var r,n,o,i,s;if(null!=e&&(e=e.valueOf()),null!=t&&(t=t.valueOf()),Array.isArray(e))for(i=0,s=e.length;i<s;i++)r=e[i],this.instruction(r);else if(p(e))for(r in e)f.call(e,r)&&(n=e[r],this.instruction(r,n));else h(t)&&(t=t.apply()),o=new a(this,e,t),this.children.push(o);return this},e.prototype.instructionBefore=function(e,t){var r,n;return r=this.parent.children.indexOf(this),n=this.parent.children.splice(r),this.parent.instruction(e,t),Array.prototype.push.apply(this.parent.children,n),this},e.prototype.instructionAfter=function(e,t){var r,n;return r=this.parent.children.indexOf(this),n=this.parent.children.splice(r+1),this.parent.instruction(e,t),Array.prototype.push.apply(this.parent.children,n),this},e.prototype.declaration=function(e,t,r){var n,i;return n=this.document(),i=new o(n,e,t,r),n.children[0]instanceof o?n.children[0]=i:n.children.unshift(i),n.root()||n},e.prototype.doctype=function(e,t){var r,n,o,s,a,c,u,l,h;for(r=this.document(),n=new i(r,e,t),o=s=0,c=(l=r.children).length;s<c;o=++s)if(l[o]instanceof i)return r.children[o]=n,n;for(o=a=0,u=(h=r.children).length;a<u;o=++a)if(h[o].isRoot)return r.children.splice(o,0,n),n;return r.children.push(n),n},e.prototype.up=function(){if(this.isRoot)throw new Error("The root node has no parent. Use doc() if you need to get the document object.");return this.parent},e.prototype.root=function(){var e;for(e=this;e;){if(e.isDocument)return e.rootObject;if(e.isRoot)return e;e=e.parent}},e.prototype.document=function(){var e;for(e=this;e;){if(e.isDocument)return e;e=e.parent}},e.prototype.end=function(e){return this.document().end(e)},e.prototype.prev=function(){var e;if((e=this.parent.children.indexOf(this))<1)throw new Error("Already at the first node");return this.parent.children[e-1]},e.prototype.next=function(){var e;if(-1===(e=this.parent.children.indexOf(this))||e===this.parent.children.length-1)throw new Error("Already at the last node");return this.parent.children[e+1]},e.prototype.importDocument=function(e){var t;return(t=e.root().clone()).parent=this,t.isRoot=!1,this.children.push(t),this},e.prototype.ele=function(e,t,r){return this.element(e,t,r)},e.prototype.nod=function(e,t,r){return this.node(e,t,r)},e.prototype.txt=function(e){return this.text(e)},e.prototype.dat=function(e){return this.cdata(e)},e.prototype.com=function(e){return this.comment(e)},e.prototype.ins=function(e,t){return this.instruction(e,t)},e.prototype.doc=function(){return this.document()},e.prototype.dec=function(e,t,r){return this.declaration(e,t,r)},e.prototype.dtd=function(e,t){return this.doctype(e,t)},e.prototype.e=function(e,t,r){return this.element(e,t,r)},e.prototype.n=function(e,t,r){return this.node(e,t,r)},e.prototype.t=function(e){return this.text(e)},e.prototype.d=function(e){return this.cdata(e)},e.prototype.c=function(e){return this.comment(e)},e.prototype.r=function(e){return this.raw(e)},e.prototype.i=function(e,t){return this.instruction(e,t)},e.prototype.u=function(){return this.up()},e.prototype.importXMLBuilder=function(e){return this.importDocument(e)},e}()}).call(this)},181:function(e,t,r){(function(){var t,n={}.hasOwnProperty;t=r(26),e.exports=function(e){function t(e,r,n){if(t.__super__.constructor.call(this,e),null==r)throw new Error("Missing instruction target");this.target=this.stringify.insTarget(r),n&&(this.value=this.stringify.insValue(n))}return function(e,t){for(var r in t)n.call(t,r)&&(e[r]=t[r]);function o(){this.constructor=e}o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype}(t,e),t.prototype.clone=function(){return Object.create(this)},t.prototype.toString=function(e){return this.options.writer.set(e).processingInstruction(this)},t}(t)}).call(this)},406:function(e,t,r){(function(){var t,n={}.hasOwnProperty;t=r(26),e.exports=function(e){function t(e,r){if(t.__super__.constructor.call(this,e),null==r)throw new Error("Missing raw text");this.value=this.stringify.raw(r)}return function(e,t){for(var r in t)n.call(t,r)&&(e[r]=t[r]);function o(){this.constructor=e}o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype}(t,e),t.prototype.clone=function(){return Object.create(this)},t.prototype.toString=function(e){return this.options.writer.set(e).raw(this)},t}(t)}).call(this)},996:function(e,t,r){(function(){var t,n,o,i,s,a,c,u,l,h,p,d,f,m={}.hasOwnProperty;c=r(77),u=r(544),t=r(170),n=r(96),l=r(161),p=r(406),d=r(595),h=r(181),o=r(179),i=r(347),s=r(580),a=r(777),f=r(751),e.exports=function(e){function r(e,t){r.__super__.constructor.call(this,t),this.stream=e}return function(e,t){for(var r in t)m.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(r,e),r.prototype.document=function(e){var t,r,o,i,s,a,l,p;for(r=0,i=(a=e.children).length;r<i;r++)(t=a[r]).isLastRootNode=!1;for(e.children[e.children.length-1].isLastRootNode=!0,p=[],o=0,s=(l=e.children).length;o<s;o++)switch(t=l[o],!1){case!(t instanceof c):p.push(this.declaration(t));break;case!(t instanceof u):p.push(this.docType(t));break;case!(t instanceof n):p.push(this.comment(t));break;case!(t instanceof h):p.push(this.processingInstruction(t));break;default:p.push(this.element(t))}return p},r.prototype.attribute=function(e){return this.stream.write(" "+e.name+'="'+e.value+'"')},r.prototype.cdata=function(e,t){return this.stream.write(this.space(t)+"<![CDATA["+e.text+"]]>"+this.endline(e))},r.prototype.comment=function(e,t){return this.stream.write(this.space(t)+"\x3c!-- "+e.text+" --\x3e"+this.endline(e))},r.prototype.declaration=function(e,t){return this.stream.write(this.space(t)),this.stream.write('<?xml version="'+e.version+'"'),null!=e.encoding&&this.stream.write(' encoding="'+e.encoding+'"'),null!=e.standalone&&this.stream.write(' standalone="'+e.standalone+'"'),this.stream.write(this.spacebeforeslash+"?>"),this.stream.write(this.endline(e))},r.prototype.docType=function(e,r){var c,u,l,p;if(r||(r=0),this.stream.write(this.space(r)),this.stream.write("<!DOCTYPE "+e.root().name),e.pubID&&e.sysID?this.stream.write(' PUBLIC "'+e.pubID+'" "'+e.sysID+'"'):e.sysID&&this.stream.write(' SYSTEM "'+e.sysID+'"'),e.children.length>0){for(this.stream.write(" ["),this.stream.write(this.endline(e)),u=0,l=(p=e.children).length;u<l;u++)switch(c=p[u],!1){case!(c instanceof o):this.dtdAttList(c,r+1);break;case!(c instanceof i):this.dtdElement(c,r+1);break;case!(c instanceof s):this.dtdEntity(c,r+1);break;case!(c instanceof a):this.dtdNotation(c,r+1);break;case!(c instanceof t):this.cdata(c,r+1);break;case!(c instanceof n):this.comment(c,r+1);break;case!(c instanceof h):this.processingInstruction(c,r+1);break;default:throw new Error("Unknown DTD node type: "+c.constructor.name)}this.stream.write("]")}return this.stream.write(this.spacebeforeslash+">"),this.stream.write(this.endline(e))},r.prototype.element=function(e,r){var o,i,s,a,c,u,f,y;for(c in r||(r=0),y=this.space(r),this.stream.write(y+"<"+e.name),u=e.attributes)m.call(u,c)&&(o=u[c],this.attribute(o));if(0===e.children.length||e.children.every((function(e){return""===e.value})))this.allowEmpty?this.stream.write("></"+e.name+">"):this.stream.write(this.spacebeforeslash+"/>");else if(this.pretty&&1===e.children.length&&null!=e.children[0].value)this.stream.write(">"),this.stream.write(e.children[0].value),this.stream.write("</"+e.name+">");else{for(this.stream.write(">"+this.newline),s=0,a=(f=e.children).length;s<a;s++)switch(i=f[s],!1){case!(i instanceof t):this.cdata(i,r+1);break;case!(i instanceof n):this.comment(i,r+1);break;case!(i instanceof l):this.element(i,r+1);break;case!(i instanceof p):this.raw(i,r+1);break;case!(i instanceof d):this.text(i,r+1);break;case!(i instanceof h):this.processingInstruction(i,r+1);break;default:throw new Error("Unknown XML node type: "+i.constructor.name)}this.stream.write(y+"</"+e.name+">")}return this.stream.write(this.endline(e))},r.prototype.processingInstruction=function(e,t){return this.stream.write(this.space(t)+"<?"+e.target),e.value&&this.stream.write(" "+e.value),this.stream.write(this.spacebeforeslash+"?>"+this.endline(e))},r.prototype.raw=function(e,t){return this.stream.write(this.space(t)+e.value+this.endline(e))},r.prototype.text=function(e,t){return this.stream.write(this.space(t)+e.value+this.endline(e))},r.prototype.dtdAttList=function(e,t){return this.stream.write(this.space(t)+"<!ATTLIST "+e.elementName+" "+e.attributeName+" "+e.attributeType),"#DEFAULT"!==e.defaultValueType&&this.stream.write(" "+e.defaultValueType),e.defaultValue&&this.stream.write(' "'+e.defaultValue+'"'),this.stream.write(this.spacebeforeslash+">"+this.endline(e))},r.prototype.dtdElement=function(e,t){return this.stream.write(this.space(t)+"<!ELEMENT "+e.name+" "+e.value),this.stream.write(this.spacebeforeslash+">"+this.endline(e))},r.prototype.dtdEntity=function(e,t){return this.stream.write(this.space(t)+"<!ENTITY"),e.pe&&this.stream.write(" %"),this.stream.write(" "+e.name),e.value?this.stream.write(' "'+e.value+'"'):(e.pubID&&e.sysID?this.stream.write(' PUBLIC "'+e.pubID+'" "'+e.sysID+'"'):e.sysID&&this.stream.write(' SYSTEM "'+e.sysID+'"'),e.nData&&this.stream.write(" NDATA "+e.nData)),this.stream.write(this.spacebeforeslash+">"+this.endline(e))},r.prototype.dtdNotation=function(e,t){return this.stream.write(this.space(t)+"<!NOTATION "+e.name),e.pubID&&e.sysID?this.stream.write(' PUBLIC "'+e.pubID+'" "'+e.sysID+'"'):e.pubID?this.stream.write(' PUBLIC "'+e.pubID+'"'):e.sysID&&this.stream.write(' SYSTEM "'+e.sysID+'"'),this.stream.write(this.spacebeforeslash+">"+this.endline(e))},r.prototype.endline=function(e){return e.isLastRootNode?"":this.newline},r}(f)}).call(this)},434:function(e,t,r){(function(){var t,n,o,i,s,a,c,u,l,h,p,d,f,m={}.hasOwnProperty;c=r(77),u=r(544),t=r(170),n=r(96),l=r(161),p=r(406),d=r(595),h=r(181),o=r(179),i=r(347),s=r(580),a=r(777),f=r(751),e.exports=function(e){function r(e){r.__super__.constructor.call(this,e)}return function(e,t){for(var r in t)m.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(r,e),r.prototype.document=function(e){var t,r,o,i,s;for(this.textispresent=!1,i="",r=0,o=(s=e.children).length;r<o;r++)t=s[r],i+=function(){switch(!1){case!(t instanceof c):return this.declaration(t);case!(t instanceof u):return this.docType(t);case!(t instanceof n):return this.comment(t);case!(t instanceof h):return this.processingInstruction(t);default:return this.element(t,0)}}.call(this);return this.pretty&&i.slice(-this.newline.length)===this.newline&&(i=i.slice(0,-this.newline.length)),i},r.prototype.attribute=function(e){return" "+e.name+'="'+e.value+'"'},r.prototype.cdata=function(e,t){return this.space(t)+"<![CDATA["+e.text+"]]>"+this.newline},r.prototype.comment=function(e,t){return this.space(t)+"\x3c!-- "+e.text+" --\x3e"+this.newline},r.prototype.declaration=function(e,t){var r;return r=this.space(t),r+='<?xml version="'+e.version+'"',null!=e.encoding&&(r+=' encoding="'+e.encoding+'"'),null!=e.standalone&&(r+=' standalone="'+e.standalone+'"'),(r+=this.spacebeforeslash+"?>")+this.newline},r.prototype.docType=function(e,r){var c,u,l,p,d;if(r||(r=0),p=this.space(r),p+="<!DOCTYPE "+e.root().name,e.pubID&&e.sysID?p+=' PUBLIC "'+e.pubID+'" "'+e.sysID+'"':e.sysID&&(p+=' SYSTEM "'+e.sysID+'"'),e.children.length>0){for(p+=" [",p+=this.newline,u=0,l=(d=e.children).length;u<l;u++)c=d[u],p+=function(){switch(!1){case!(c instanceof o):return this.dtdAttList(c,r+1);case!(c instanceof i):return this.dtdElement(c,r+1);case!(c instanceof s):return this.dtdEntity(c,r+1);case!(c instanceof a):return this.dtdNotation(c,r+1);case!(c instanceof t):return this.cdata(c,r+1);case!(c instanceof n):return this.comment(c,r+1);case!(c instanceof h):return this.processingInstruction(c,r+1);default:throw new Error("Unknown DTD node type: "+c.constructor.name)}}.call(this);p+="]"}return(p+=this.spacebeforeslash+">")+this.newline},r.prototype.element=function(e,r){var o,i,s,a,c,u,f,y,_,g,v,w,b;for(f in r||(r=0),b=!1,this.textispresent?(this.newline="",this.pretty=!1):(this.newline=this.newlinedefault,this.pretty=this.prettydefault),y="",y+=(w=this.space(r))+"<"+e.name,_=e.attributes)m.call(_,f)&&(o=_[f],y+=this.attribute(o));if(0===e.children.length||e.children.every((function(e){return""===e.value})))this.allowEmpty?y+="></"+e.name+">"+this.newline:y+=this.spacebeforeslash+"/>"+this.newline;else if(this.pretty&&1===e.children.length&&null!=e.children[0].value)y+=">",y+=e.children[0].value,y+="</"+e.name+">"+this.newline;else{if(this.dontprettytextnodes)for(s=0,c=(g=e.children).length;s<c;s++)if(null!=(i=g[s]).value){this.textispresent++,b=!0;break}for(this.textispresent&&(this.newline="",this.pretty=!1,w=this.space(r)),y+=">"+this.newline,a=0,u=(v=e.children).length;a<u;a++)i=v[a],y+=function(){switch(!1){case!(i instanceof t):return this.cdata(i,r+1);case!(i instanceof n):return this.comment(i,r+1);case!(i instanceof l):return this.element(i,r+1);case!(i instanceof p):return this.raw(i,r+1);case!(i instanceof d):return this.text(i,r+1);case!(i instanceof h):return this.processingInstruction(i,r+1);default:throw new Error("Unknown XML node type: "+i.constructor.name)}}.call(this);b&&this.textispresent--,this.textispresent||(this.newline=this.newlinedefault,this.pretty=this.prettydefault),y+=w+"</"+e.name+">"+this.newline}return y},r.prototype.processingInstruction=function(e,t){var r;return r=this.space(t)+"<?"+e.target,e.value&&(r+=" "+e.value),r+(this.spacebeforeslash+"?>")+this.newline},r.prototype.raw=function(e,t){return this.space(t)+e.value+this.newline},r.prototype.text=function(e,t){return this.space(t)+e.value+this.newline},r.prototype.dtdAttList=function(e,t){var r;return r=this.space(t)+"<!ATTLIST "+e.elementName+" "+e.attributeName+" "+e.attributeType,"#DEFAULT"!==e.defaultValueType&&(r+=" "+e.defaultValueType),e.defaultValue&&(r+=' "'+e.defaultValue+'"'),r+(this.spacebeforeslash+">")+this.newline},r.prototype.dtdElement=function(e,t){return this.space(t)+"<!ELEMENT "+e.name+" "+e.value+this.spacebeforeslash+">"+this.newline},r.prototype.dtdEntity=function(e,t){var r;return r=this.space(t)+"<!ENTITY",e.pe&&(r+=" %"),r+=" "+e.name,e.value?r+=' "'+e.value+'"':(e.pubID&&e.sysID?r+=' PUBLIC "'+e.pubID+'" "'+e.sysID+'"':e.sysID&&(r+=' SYSTEM "'+e.sysID+'"'),e.nData&&(r+=" NDATA "+e.nData)),r+(this.spacebeforeslash+">")+this.newline},r.prototype.dtdNotation=function(e,t){var r;return r=this.space(t)+"<!NOTATION "+e.name,e.pubID&&e.sysID?r+=' PUBLIC "'+e.pubID+'" "'+e.sysID+'"':e.pubID?r+=' PUBLIC "'+e.pubID+'"':e.sysID&&(r+=' SYSTEM "'+e.sysID+'"'),r+(this.spacebeforeslash+">")+this.newline},r.prototype.openNode=function(e,t){var r,n,o,i;if(t||(t=0),e instanceof l){for(n in o=this.space(t)+"<"+e.name,i=e.attributes)m.call(i,n)&&(r=i[n],o+=this.attribute(r));return o+(e.children?">":"/>")+this.newline}return o=this.space(t)+"<!DOCTYPE "+e.rootNodeName,e.pubID&&e.sysID?o+=' PUBLIC "'+e.pubID+'" "'+e.sysID+'"':e.sysID&&(o+=' SYSTEM "'+e.sysID+'"'),o+(e.children?" [":">")+this.newline},r.prototype.closeNode=function(e,t){switch(t||(t=0),!1){case!(e instanceof l):return this.space(t)+"</"+e.name+">"+this.newline;case!(e instanceof u):return this.space(t)+"]>"+this.newline}},r}(f)}).call(this)},549:function(e){(function(){var t={}.hasOwnProperty;e.exports=function(){function e(e){var r,n,o,i,s;for(o in this.assertLegalChar=(r=this.assertLegalChar,n=this,function(){return r.apply(n,arguments)}),e||(e={}),this.noDoubleEncoding=e.noDoubleEncoding,i=e.stringify||{})t.call(i,o)&&(s=i[o],this[o]=s)}return e.prototype.eleName=function(e){return e=""+e||"",this.assertLegalChar(e)},e.prototype.eleText=function(e){return e=""+e||"",this.assertLegalChar(this.elEscape(e))},e.prototype.cdata=function(e){return e=(e=""+e||"").replace("]]>","]]]]><![CDATA[>"),this.assertLegalChar(e)},e.prototype.comment=function(e){if((e=""+e||"").match(/--/))throw new Error("Comment text cannot contain double-hypen: "+e);return this.assertLegalChar(e)},e.prototype.raw=function(e){return""+e||""},e.prototype.attName=function(e){return""+e||""},e.prototype.attValue=function(e){return e=""+e||"",this.attEscape(e)},e.prototype.insTarget=function(e){return""+e||""},e.prototype.insValue=function(e){if((e=""+e||"").match(/\?>/))throw new Error("Invalid processing instruction value: "+e);return e},e.prototype.xmlVersion=function(e){if(!(e=""+e||"").match(/1\.[0-9]+/))throw new Error("Invalid version number: "+e);return e},e.prototype.xmlEncoding=function(e){if(!(e=""+e||"").match(/^[A-Za-z](?:[A-Za-z0-9._-])*$/))throw new Error("Invalid encoding: "+e);return e},e.prototype.xmlStandalone=function(e){return e?"yes":"no"},e.prototype.dtdPubID=function(e){return""+e||""},e.prototype.dtdSysID=function(e){return""+e||""},e.prototype.dtdElementValue=function(e){return""+e||""},e.prototype.dtdAttType=function(e){return""+e||""},e.prototype.dtdAttDefault=function(e){return null!=e?""+e||"":e},e.prototype.dtdEntityValue=function(e){return""+e||""},e.prototype.dtdNData=function(e){return""+e||""},e.prototype.convertAttKey="@",e.prototype.convertPIKey="?",e.prototype.convertTextKey="#text",e.prototype.convertCDataKey="#cdata",e.prototype.convertCommentKey="#comment",e.prototype.convertRawKey="#raw",e.prototype.assertLegalChar=function(e){var t;if(t=e.match(/[\0\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/))throw new Error("Invalid character in string: "+e+" at index "+t.index);return e},e.prototype.elEscape=function(e){var t;return t=this.noDoubleEncoding?/(?!&\S+;)&/g:/&/g,e.replace(t,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#xD;")},e.prototype.attEscape=function(e){var t;return t=this.noDoubleEncoding?/(?!&\S+;)&/g:/&/g,e.replace(t,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")},e}()}).call(this)},595:function(e,t,r){(function(){var t,n={}.hasOwnProperty;t=r(26),e.exports=function(e){function t(e,r){if(t.__super__.constructor.call(this,e),null==r)throw new Error("Missing element text");this.value=this.stringify.eleText(r)}return function(e,t){for(var r in t)n.call(t,r)&&(e[r]=t[r]);function o(){this.constructor=e}o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype}(t,e),t.prototype.clone=function(){return Object.create(this)},t.prototype.toString=function(e){return this.options.writer.set(e).text(this)},t}(t)}).call(this)},751:function(e){(function(){var t={}.hasOwnProperty;e.exports=function(){function e(e){var r,n,o,i,s,a,c,u,l;for(r in e||(e={}),this.pretty=e.pretty||!1,this.allowEmpty=null!=(n=e.allowEmpty)&&n,this.pretty?(this.indent=null!=(o=e.indent)?o:"  ",this.newline=null!=(i=e.newline)?i:"\n",this.offset=null!=(s=e.offset)?s:0,this.dontprettytextnodes=null!=(a=e.dontprettytextnodes)?a:0):(this.indent="",this.newline="",this.offset=0,this.dontprettytextnodes=0),this.spacebeforeslash=null!=(c=e.spacebeforeslash)?c:"",!0===this.spacebeforeslash&&(this.spacebeforeslash=" "),this.newlinedefault=this.newline,this.prettydefault=this.pretty,u=e.writer||{})t.call(u,r)&&(l=u[r],this[r]=l)}return e.prototype.set=function(e){var r,n,o;for(r in e||(e={}),"pretty"in e&&(this.pretty=e.pretty),"allowEmpty"in e&&(this.allowEmpty=e.allowEmpty),this.pretty?(this.indent="indent"in e?e.indent:"  ",this.newline="newline"in e?e.newline:"\n",this.offset="offset"in e?e.offset:0,this.dontprettytextnodes="dontprettytextnodes"in e?e.dontprettytextnodes:0):(this.indent="",this.newline="",this.offset=0,this.dontprettytextnodes=0),this.spacebeforeslash="spacebeforeslash"in e?e.spacebeforeslash:"",!0===this.spacebeforeslash&&(this.spacebeforeslash=" "),this.newlinedefault=this.newline,this.prettydefault=this.pretty,n=e.writer||{})t.call(n,r)&&(o=n[r],this[r]=o);return this},e.prototype.space=function(e){var t;return this.pretty&&(t=(e||0)+this.offset+1)>0?new Array(t).join(this.indent):""},e}()}).call(this)},532:function(e,t,r){(function(){var t,n,o,i,s,a,c;c=r(369),s=c.assign,a=c.isFunction,t=r(934),n=r(505),i=r(434),o=r(996),e.exports.create=function(e,r,n,o){var i,a;if(null==e)throw new Error("Root element needs a name");return o=s({},r,n,o),a=(i=new t(o)).element(e),o.headless||(i.declaration(o),null==o.pubID&&null==o.sysID||i.doctype(o)),a},e.exports.begin=function(e,r,o){var i;return a(e)&&(r=(i=[e,r])[0],o=i[1],e={}),r?new n(e,r,o):new t(e)},e.exports.stringWriter=function(e){return new i(e)},e.exports.streamWriter=function(e,t){return new o(e,t)}}).call(this)}},a={};function c(e){var t=a[e];if(void 0!==t)return t.exports;var r=a[e]={exports:{}};return s[e].call(r.exports,r,r.exports,c),r.exports}c.d=(e,t)=>{for(var r in t)c.o(t,r)&&!c.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var u={};(()=>{c.d(u,{Z:()=>te});var s=c(187),a=c(227);const l=(h={uptime:()=>e.uptime,userInfo:()=>e.userInfo},p={},c.d(p,h),p);var h,p;a("vol_data").log=console.log.bind(console);const d={TYPE_UNKNOWN:"unknown",TYPE_HFS_PLUS:"hfs",TYPE_APFS:"apfs",TYPE_UDF:"udf",TYPE_MSDOS:"msdos",TYPE_NTFS:"ntfs",TYPE_SMBFS:"smbfs",TYPE_EXT4:"ext4",TYPE_VFAT:"vfat"},f={BASE_2:2,BASE_10:10};class m{constructor(e){let t,r,n,o,i,s,a=d.TYPE_UNKNOWN,c=0,u=0,l=!1,h=!1,p=!1;if(void 0!==e){if("object"!=typeof e)throw new TypeError("'data' must be an object");if(Object.prototype.hasOwnProperty.call(e,"name")&&"string"==typeof e.name&&(t=e.name),Object.prototype.hasOwnProperty.call(e,"disk_id")&&"string"==typeof e.disk_id&&(r=e.disk_id),Object.prototype.hasOwnProperty.call(e,"volume_type")&&"string"==typeof e.volume_type){if(!Object.values(d).includes(e.volume_type))throw new RangeError(`Unrecognized volume type specified. (${e.volume_type})`);a=e.volume_type}if(Object.prototype.hasOwnProperty.call(e,"mount_point")&&"string"==typeof e.mount_point&&(n=e.mount_point),Object.prototype.hasOwnProperty.call(e,"capacity_bytes")&&"number"==typeof e.capacity_bytes){if(!(e.capacity_bytes>=0))throw new RangeError(`Volume capacity size must be greater than or equal to 0. (${e.capacity_bytes})`);c=e.capacity_bytes}if(Object.prototype.hasOwnProperty.call(e,"device_node")&&"string"==typeof e.device_node&&(o=e.device_node),Object.prototype.hasOwnProperty.call(e,"volume_uuid")&&"string"==typeof e.volume_uuid&&(i=e.volume_uuid),Object.prototype.hasOwnProperty.call(e,"free_space_bytes")&&"number"==typeof e.free_space_bytes){if(!(e.free_space_bytes>=0))throw new RangeError(`Volume free space size must be greater than or equal to 0. (${e.free_space_bytes})`);u=e.free_space_bytes}if(Object.prototype.hasOwnProperty.call(e,"used_space_bytes")&&"number"==typeof e.used_space_bytes){if(!(e.used_space_bytes>=0))throw new RangeError(`Volume used space size must be greater than or equal to 0. (${e.used_space_bytes})`);s=e.used_space_bytes}Object.prototype.hasOwnProperty.call(e,"visible")&&"boolean"==typeof e.visible&&(l=e.visible),Object.prototype.hasOwnProperty.call(e,"shown")&&"boolean"==typeof e.shown&&(h=e.shown),Object.prototype.hasOwnProperty.call(e,"low_space_alert")&&"boolean"==typeof e.low_space_alert&&(p=e.low_space_alert)}if(this._name=t,this._disk_identifier=r,this._volume_type=a,this._mount_point=n,this._capacity_bytes=c,this._device_node=o,this._volume_uuid=i,this._free_space_bytes=u,this._visible=l,this._shown=h,this._low_space_alert=p,this._used_space_bytes=void 0===s?c-u:s,this._used_space_bytes<0)throw new RangeError(`Used space cannot be negative. ${this._used_space_bytes}`)}get Name(){return this._name}get DiskId(){return this._disk_identifier}get VolumeType(){return this._volume_type}get MountPoint(){return this._mount_point}get DeviceNode(){return this._device_node}get VolumeUUID(){return this._volume_uuid}get Size(){return this._capacity_bytes}get FreeSpace(){return this._free_space_bytes}get UsedSpace(){return this._used_space_bytes}get IsMounted(){return void 0!==this._mount_point&&this._mount_point.length>0}get IsVisible(){return this._visible}get LowSpaceAlert(){return this._low_space_alert}get PercentFree(){return this.FreeSpace/this.Size*100}get IsShown(){return this._shown}IsMatch(e){return e instanceof m&&this.Name===e.Name&&this.VolumeType===e.VolumeType&&this.DeviceNode===e.DeviceNode&&this.MountPoint===e.MountPoint}static ConvertFromBytesToGB(e,t){if(void 0===e||"number"!=typeof e)throw new TypeError("'bytes' must be a number.");let r=1073741824;if(void 0!==t){if(!Object.values(f).includes(t))throw new RangeError(`'base' has an unsupported value. {${t}}`);f.BASE_10===t&&(r=1e9)}return e/r}static ConvertFrom1KBlockaToBytes(e){if(void 0===e||"number"!=typeof e)throw new TypeError("'blocks' must be a number.");if(e<0)throw new RangeError(`'blocks' must be a positive number. (${e})`);return 1024*e}}const y=(e=>{var t={};return c.d(t,e),t})({access:()=>t.access}),_=(e=>{var t={};return c.d(t,e),t})({constants:()=>r.constants,readFileSync:()=>r.readFileSync,watch:()=>r.watch}),g=new a("vi_process"),v="change_detected",w="watch_add_result";class b extends s{constructor(){super(),this._timeoutID=-1,this._watchers=new Map,this._CB__VolumeWatcherChange=this._handleVolumeWatcherChangeDetected.bind(this)}Terminate(){this._watchers.forEach(((e,t)=>{g(`Volume Watcher closing target '${t}`),e.close()})),this._watchers.clear(),this.removeAllListeners(v),this.removeAllListeners(w)}async AddWatches(e){if(void 0===e||!Array.isArray(e)||e.length<=0)throw new TypeError("'watchList' is not a non-zero length array.");for(const t of e)if(!Object.prototype.hasOwnProperty.call(t,"target")||"string"!=typeof t.target||t.target.length<=0)throw new TypeError("'watchList' item does not contain a field 'target' or 'target' is not a non-null string.");return new Promise((t=>{(async e=>{let r=!0;const n=[];for(const t of e)n.push(this.ValidateAccess(t.target,_.constants.F_OK));const o=await Promise.all(n);for(const t of e){let e=!1,n=!1;Object.prototype.hasOwnProperty.call(t,"recursive")&&"boolean"==typeof t.recursive&&(e=t.recursive),Object.prototype.hasOwnProperty.call(t,"ignoreAccess")&&"boolean"==typeof t.ignoreAccess&&(n=t.ignoreAccess);let i=!1,s=!1;for(const e of o)if(e.target===t.target){i=e.success,s=!0;break}if(!s)throw new Error(`target:${t} not found in 'accessResults'`);const a=i||n;if(a){const r=this._watchers.has(t.target);g(`Watch target: '${t.target}' accessOk:${i} exists:${r}`),r&&this.DeleteWatch(t.target);const n=(0,_.watch)(t.target,{persistent:!0,recursive:e,encoding:"utf8"},this._CB__VolumeWatcherChange);this._watchers.set(t.target,n)}else g(`Unable to watch target: '${t.target}`),r=!1;this.emit(w,{target:t.target,success:a})}t(r)})(e)}))}DeleteWatch(e){let t=!1;const r=this._watchers.get(e);return void 0!==r&&(r.close(),t=this._watchers.delete(e)),t}ListWatches(){const e=[],t=this._watchers.keys();for(const r of t)e.push(r);return e}async ValidateAccess(e,t){if(null==e||"string"!=typeof e||e.length<1)throw new TypeError("'target' is not a non-zero string.");if(null==t||"number"!=typeof t)throw new TypeError("'accessMode' is not a number");return new Promise((r=>{(async(e,t)=>{try{await(0,y.access)(e,t),r({target:e,success:!0})}catch{r({target:e,success:!1})}})(e,t)}))}_handleVolumeWatcherChangeDetected(e,t){setImmediate(((e,t)=>{g(`Volume Watcher Change Detected: type:${e} name:${t}`),this.emit(v,e,t)}),e,t)}}const N=(e=>{var t={};return c.d(t,e),t})({spawn:()=>n.spawn}),E=a("spawn_helper");E.log=console.log.bind(console);class C extends s{constructor(e){if(void 0!==e)throw new TypeError("SpawnHelper does not use any arguments.");super(),this._command=void 0,this._arguments=void 0,this._options=void 0,this._token=void 0,this._result_data=void 0,this._error_data=void 0,this._error_encountered=!1,this._pending=!1,this._CB__process_stdout_data=this._process_stdout_data.bind(this),this._CB__process_stderror_data=this._process_stderror_data.bind(this),this._CB_process_message=this._process_message.bind(this),this._CB_process_error=this._process_error.bind(this),this._CB_process_close=this._process_close.bind(this)}get IsPending(){return this._pending}get IsValid(){return void 0!==this._command&&!this.IsPending&&!this._error_encountered}get Result(){return this._result_data}get Error(){return this._error_data}get Command(){return this._command}get Arguments(){return this._arguments}get Options(){return this._options}get Token(){return this._token}Spawn(e){if(this.IsPending)throw new Error("Spawn is already in progress.");if(void 0===e||"object"!=typeof e)throw new TypeError("request must be an obkect");if(!Object.prototype.hasOwnProperty.call(e,"command")||"string"!=typeof e.command||e.command.length<=0)throw new TypeError("request.command must be a non-zero length string.");if(this._command=e.command,Object.prototype.hasOwnProperty.call(e,"arguments")){if(!Array.isArray(e.arguments))throw new TypeError("request.arguments must be an array of strings.");for(const t of e.arguments)if("string"!=typeof t)throw new TypeError("request.arguments must contain only strings.");this._arguments=e.arguments}else this._arguments=[];if(Object.prototype.hasOwnProperty.call(e,"options")){if(!Array.isArray(e.options))throw new TypeError("request.options must be an array of strings.");for(const t of e.options)if("string"!=typeof t)throw new TypeError("request.options must contain only strings.");this._options=e.options}else this._options=[];if(Object.prototype.hasOwnProperty.call(e,"token")){if(void 0===e.token)throw new TypeError("request.token must be something if it is specified.");this._token=e.token}else this._token=void 0;this._result_data=void 0,this._error_data=void 0,this._error_encountered=!1,this._pending=!0;const t=(0,N.spawn)(this._command,this._arguments,this._options);t.stdout.on("data",this._CB__process_stdout_data),t.stderr.on("data",this._CB__process_stderror_data),t.on("message",this._CB_process_message),t.on("error",this._CB_process_error),t.on("close",this._CB_process_close)}_process_stdout_data(e){void 0===this._result_data?this._result_data=e:this._result_data+=e}_process_stderror_data(e){void 0===this._error_data?this._error_data=e:this._error_data+=e,this._error_encountered=!0}_process_message(e,t){E(`Child Process for ${this.Command}: '${e}'`)}_process_error(e){E(`Child Process for ${this.Command}: error_num:${e.number} error_name:${e.name} error_msg:${e.message}`),this._error_encountered=!0}_process_close(e,t){E(`Child Process for ${this.Command}: exit_code:${e} by signal:'${t}'`),this._pending=!1;const r=this.IsValid,n={valid:r,result:r?this.Result:this.Error,token:this.Token,source:this};this.emit("complete",n)}}const I=a("vi_process"),O=a("vi_config");I.log=console.log.bind(console),O.log=console.log.bind(console);const S=5/60,D=-1,A=6e5,T={Name:"name",SerialNumber:"serial_num"},x="scanning",P="ready";class k extends s{constructor(e){let t=6,r=15;const n=[],o=[];if(void 0!==e){if(Object.prototype.hasOwnProperty.call(e,"period_hr")){if(!("number"==typeof e.period_hr&&e.period_hr>=S&&e.period_hr<=744))throw"number"!=typeof e.period_hr?new TypeError(`'config.period_hr' must be a number between ${S} and 744`):new RangeError(`'config.period_hr' must be a number between ${S} and 744`);t=e.period_hr}if(Object.prototype.hasOwnProperty.call(e,"default_alarm_threshold")){if(!("number"==typeof e.period_hr&&e.default_alarm_threshold>=0&&e.default_alarm_threshold<=100))throw"number"!=typeof e.period_hr?new TypeError("'config.default_alarm_threshold' must be a number between 0 and 100"):new RangeError("'config.default_alarm_threshold' must be a number between 0 and 100");r=e.default_alarm_threshold}if(Object.prototype.hasOwnProperty.call(e,"exclusion_masks")){if(!Array.isArray(e.exclusion_masks))throw new TypeError("'config.volume_customizations' must be an array.");for(const t of e.exclusion_masks){if(!k._validateVolumeExclusionMask(t))throw new TypeError("'config.volume_customizations' item is not valid.");o.push(t)}}if(Object.prototype.hasOwnProperty.call(e,"volume_customizations")){if(!Array.isArray(e.volume_customizations))throw new TypeError("'config.volume_customizations' must be an array.");for(const t of e.volume_customizations){if(!k._validateVolumeCustomization(t))throw new TypeError("'config.volume_customizations' item is not valid.");n.push(t)}}}super(),this._timeoutID=D,this._deferInitCheckTimeoutID=D,this._decoupledStartTimeoutID=D,this._checkInProgress=!1,this._period_hr=6,this._theVolumes=[],this._defaultAlarmThreshold=r,this._volumeCustomizations=n,this._exclusionMasks=o,this._CB__initiateCheck=this._on_initiateCheck.bind(this),this._CB__ResetCheck=this._on_reset_check.bind(this),this._DECOUPLE_Start=this.Start.bind(this),this._CB__VolumeWatcherChange=this._handleVolumeWatcherChangeDetected.bind(this),this._CB__VolumeWatcherAdded=this._handleVolumeWatcherAdded.bind(this),this.Period=t;const i=this._watchFolders,s=[];for(const e of i)s.push({target:e,recursive:!1,ignoreAccess:!1});this._volWatcher=new b,this._volWatcher.on(v,this._CB__VolumeWatcherChange),this._volWatcher.on(w,this._CB__VolumeWatcherAdded),this._volWatcher.AddWatches(s)}Terminate(){this.Stop(),this._volWatcher.Terminate(),this.removeAllListeners(x),this.removeAllListeners(P)}get Period(){return this._period_hr}set Period(e){if(void 0===e||"number"!=typeof e)throw new TypeError(`'period_hr' must be a number between ${S} and 744`);if(e<S&&e>744)throw new RangeError(`'period_hr' must be a number between ${S} and 744`);this._period_hr=e,this.Stop()}get MinimumPeriod(){return S}get MaximumPeriod(){return 744}get Active(){return this._timeoutID!==D}Start(){this._decoupledStartTimeoutID!==D&&clearTimeout(this._decoupledStartTimeoutID),this.Stop();const e=1e3*(0,l.uptime)();e<A?this._decoupledStartTimeoutID=setTimeout(this._DECOUPLE_Start,A-e):this._on_initiateCheck()}Stop(){this._timeoutID!==D&&(clearTimeout(this._timeoutID),this._timeoutID=D)}_on_reset_check(e){if(void 0===e||"boolean"!=typeof e)throw new TypeError("issueReadyEvent is not a boolean.");this._checkInProgress=!1,this._deferInitCheckTimeoutID=D,this._theVolumes=[],this._doReset(),this._decoupledStartTimeoutID!==D&&(clearTimeout(this._decoupledStartTimeoutID),this._decoupledStartTimeoutID=D),e&&this.emit(P,{results:[]})}_on_initiateCheck(){const e=this._checkInProgress;I(`_on_initiateCheck(): Initiating a scan. CheckInProgress=${e}`),this._checkInProgress?this._deferInitCheckTimeoutID===D&&(this._deferInitCheckTimeoutID=setTimeout(this._CB__ResetCheck,12e4,!0)):(this.emit(x),this._checkInProgress=!0,this._theVolumes=[],this._doReset(),this._initiateInterrogation());const t=e?250:36e5*this._period_hr;this._timeoutID=setTimeout(this._CB__initiateCheck,t)}_initiateInterrogation(){throw new Error("Abstract Method _initiateInterrogation() invoked!")}_doReset(){throw new Error("Abstract Method _doReset() invoked!")}get _isCheckInProgress(){throw new Error("Abstract Property _checkInProgress() invoked!")}get _watchFolders(){throw new Error("Abstract Property _watchFolders() invoked!")}_updateCheckInProgress(){const e=this._checkInProgress;if(this._checkInProgress=this._isCheckInProgress,e&&!this._checkInProgress){this.emit(P,{results:this._theVolumes}),I("Ready event.");for(const e of this._theVolumes)I(`Volume Name: ${e.Name}`),I(`\tVisible:    ${e.IsVisible}`),I(`\tShown:      ${e.IsShown}`),I(`\tMountPoint: ${e.MountPoint}`),I(`\tDevNode:    ${e.DeviceNode}`),I(`\tCapacity:   ${m.ConvertFromBytesToGB(e.Size).toFixed(4)} GB`),I(`\tFree:       ${m.ConvertFromBytesToGB(e.FreeSpace).toFixed(4)} GB`),I(`\tUsed:       ${m.ConvertFromBytesToGB(e.UsedSpace).toFixed(4)} GB`),I(`\t% Used:     ${(e.UsedSpace/e.Size*100).toFixed(2)}%`)}}_determineLowSpaceAlert(e,t,r){if(void 0===e||"string"!=typeof e||e.length<=0)throw new TypeError("'volumeName' must be a non-zero length string");if(void 0===t||"string"!=typeof t||t.length<=0)throw new TypeError("'volumeUUID' must be a non-zero length string");if(void 0===r||"number"!=typeof r)throw new TypeError("'volumePercentFree' must be a number");if(r<0||r>100)throw new RangeError(`'volumePercentFree' must be in the range of 0...100. ${r}`);let n=r<this._defaultAlarmThreshold;const o=this._volumeCustomizations.filter((r=>r.volume_id_method===T.Name&&r.volume_name.toLowerCase()===e.toLowerCase()||r.volume_id_method===T.SerialNumber&&r.volume_serial_num.toLowerCase()===t.toLowerCase()));return void 0!==o&&o.length>0&&(n=o.filter((e=>e.volume_low_space_alarm_active&&r<e.volume_alarm_threshold)).length>0),n}_handleVolumeWatcherChangeDetected(e,t){setImmediate(((e,t)=>{I(`Volume Watcher Change Detected: type:${e} name:${t} active:${this.Active} chkInProgress:${this._checkInProgress}`),this.Active&&(this._decoupledStartTimeoutID!==D&&clearTimeout(this._decoupledStartTimeoutID),this._decoupledStartTimeoutID=setTimeout(this._DECOUPLE_Start,1e3))}),e,t)}_handleVolumeWatcherAdded(e){void 0!==e&&I(`AddWatch Results: target:${e.target} status:${e.success}`)}_isVolumeShown(e){if(void 0===e||"string"!=typeof e||e.length<=0)throw new TypeError(`_isVolumeShown. mountPoint is not valid. ${e}`);let t=!0;for(const r of this._exclusionMasks){I(`Evaluating exclusion mask '${r}' for mount point '${e}'`);const n=new RegExp(r),o=e.match(n);I(o),t=t&&null===o}return t}static _validateVolumeCustomization(e){let t=void 0!==e;return t&&((!Object.prototype.hasOwnProperty.call(e,"volume_id_method")||"string"!=typeof e.volume_id_method||Object.values(T).indexOf(e.volume_id_method)<0)&&(t=!1),t&&e.volume_id_method===T.Name&&(!Object.prototype.hasOwnProperty.call(e,"volume_name")||"string"!=typeof e.volume_name||e.volume_name.length<=0)&&(t=!1),t&&e.volume_id_method===T.SerialNumber&&(!Object.prototype.hasOwnProperty.call(e,"volume_serial_num")||"string"!=typeof e.volume_serial_num||e.volume_serial_num.length<=0)&&(t=!1),Object.prototype.hasOwnProperty.call(e,"volume_low_space_alarm_active")&&"boolean"==typeof e.volume_low_space_alarm_active||(t=!1),t&&e.volume_low_space_alarm_active&&(!Object.prototype.hasOwnProperty.call(e,"volume_alarm_threshold")||"number"!=typeof e.volume_alarm_threshold||e.volume_alarm_threshold<=0||e.volume_alarm_threshold>=100)&&(t=!1)),t}static _validateVolumeExclusionMask(e){let t=void 0!==e;return t&&(t="string"==typeof e),t}}var F=c(78);const L=a("vi_process"),R=a("vi_config");L.log=console.log.bind(console),R.log=console.log.bind(console);const $=/\s+/;class V extends k{constructor(e){const t=process.platform;if(void 0===t||"string"!=typeof t||t.length<=0||"darwin"!==t.toLowerCase())throw new Error(`Operating system not supported. os:${t}`);super(e),this._pendingFileSystems=[],this._pendingVolumes=[],this._theVisibleVolumeNames=[],this._CB__list_known_virtual_filesystems_complete=this._on_lsvfs_complete.bind(this),this._CB__display_free_disk_space_complete=this._on_df_complete.bind(this),this._CB__visible_volumes=this._on_process_visible_volumes.bind(this),this._CB_process_diskUtil_info_complete=this._on_process_diskutil_info_complete.bind(this),this._CB_process_disk_utilization_stats_complete=this._on_process_disk_utilization_stats_complete.bind(this)}_initiateInterrogation(){const e=new C;e.on("complete",this._CB__visible_volumes),e.Spawn({command:"ls",arguments:["/Volumes"]})}_doReset(){this._pendingFileSystems=[],this._theVisibleVolumeNames=[],this._pendingVolumes=[]}get _isCheckInProgress(){return L(`_isCheckInProgress: Pending Volume Count - ${this._pendingVolumes.length}`),0!==this._pendingVolumes.length||0!==this._pendingFileSystems.length}get _watchFolders(){return["/Volumes"]}_on_process_visible_volumes(e){if(R(`'${e.source.Command} ${e.source.Arguments}' Spawn Helper Result: valid:${e.valid}`),R(e.result.toString()),this._checkInProgress)if(e.valid&&void 0!==e.result){this._theVisibleVolumeNames=e.result.toString().split("\n");const t=new C;t.on("complete",this._CB__list_known_virtual_filesystems_complete),t.Spawn({command:"lsvfs"})}else this._checkInProgress=!1,L(`Error processing '${e.source.Command} ${e.source.Arguments}'. Err:${e.result}`),this.emit("ready",{results:[]})}_on_lsvfs_complete(e){if(R(`'${e.source.Command} ${e.source.Arguments}' Spawn Helper Result: valid:${e.valid}`),R(e.result.toString()),this._checkInProgress)if(e.valid&&void 0!==e.result){const t=2,r=-1;e.result.toString().split("\n").slice(t,r).forEach((e=>{const t=e.split($);if(3===t.length){const e=Number.parseInt(t[1],10);if(e>0){const r={type:t[0].toLowerCase(),count:e,flags:t[2].toLowerCase()},n=this._pendingFileSystems.findIndex((e=>e.type.toLowerCase()===r.type));if(n<0){this._pendingFileSystems.push(r),L(`Spawn df for fs type '${r.type}'.`);const e=new C;e.on("complete",this._CB__display_free_disk_space_complete),e.Spawn({command:"df",arguments:["-a","-b","-T",r.type],token:r})}else this._pendingFileSystems[n]=r,L(`_on_lsvfs_complete: Duplicated file system type. '${r.type}'`)}}else L(`_on_lsvfs_complete: Error processing line '${e}'`),L(t)}))}else this._checkInProgress=!1,L(`Error processing '${e.source.Command} ${e.source.Arguments}'. Err:${e.result}`),this.emit("ready",{results:[]})}_on_df_complete(e){if(R(`'${e.source.Command} ${e.source.Arguments}' Spawn Helper Result: valid:${e.valid}`),R(e.result.toString()),void 0!==e.token&&(R("Spawn Token:"),R(e.token)),this._checkInProgress)if(e.valid&&void 0!==e.result){if(void 0===e.token)throw new Error("Spawn token is missing.");if("object"!=typeof e.token)throw new TypeError("Spawn token is not a string.");if(!this._pendingFileSystems.includes(e.token))throw new Error("Spawn token is not in the pending file system list.");if(this._pendingFileSystems=this._pendingFileSystems.filter((t=>t.type!==e.token.type||t.count!==e.token.count||t.flags!==e.token.flags)),Object.values(d).includes(e.token.type)){const t=1,r=-1;e.result.toString().split("\n").slice(t,r).forEach((t=>{const r=t.split($),n=r.slice(5,r.length);r[5]=n.join(" ");const o={device_node:r[0].toLowerCase(),blocks:Number.parseInt(r[1],10),used_blks:Number.parseInt(r[2],10),avail_blks:Number.parseInt(r[3],10),capacity:Number.parseInt(r[4].slice(0,-1),10),mount_point:r[5]};let i=o.mount_point;const s=o.mount_point.split("/");s.length>0&&s[s.length-1].length>0&&(i=s[s.length-1]);const a=this._determineLowSpaceAlert(i,"~~ not used ~~",o.avail_blks/o.blocks*100),c=new m({name:i,volume_type:e.token.type,mount_point:o.mount_point,volume_uuid:"unknown",device_node:o.device_node,capacity_bytes:512*o.blocks,free_space_bytes:512*(o.blocks-o.used_blks),visible:this._theVisibleVolumeNames.includes(i),low_space_alert:a});L(`Initiating 'diskutil info' for DiskId '${c.DeviceNode}'`);const u=new C;u.on("complete",this._CB_process_diskUtil_info_complete),u.Spawn({command:"diskutil",arguments:["info","-plist",c.DeviceNode],token:c}),this._pendingVolumes.push(c)}))}}else this._checkInProgress=!1,L(`Error processing '${e.source.Command} ${e.source.Arguments}'. Err:${e.result}`),this.emit("ready",{results:[]})}_on_process_diskutil_info_complete(e){R(`'${e.source.Command} ${e.source.Arguments}' Spawn Helper Result: valid:${e.valid}`),R(e.result.toString());let t=!1;if(this._checkInProgress){if(e.valid)try{if(e.token instanceof m?this._pendingVolumes.includes(e.token)?this._pendingVolumes=this._pendingVolumes.filter((t=>t!==e.token)):(this._checkInProgress=!1,t=!0,L("Unexpected call to _on_process_diskutil_info_complete. token not pending."),L(e.token)):(this._checkInProgress=!1,t=!0,L("Unexpected call to _on_process_diskutil_info_complete. token is not instance of VolumeData."),L(e.token)),!t){const r=F.parse(e.result.toString()),n=this._isVolumeShown(e.token.MountPoint);if(Object.prototype.hasOwnProperty.call(r,"DeviceIdentifier")&&"string"==typeof r.DeviceIdentifier)if(Object.prototype.hasOwnProperty.call(r,"VolumeName")&&"string"==typeof r.VolumeName&&Object.prototype.hasOwnProperty.call(r,"FilesystemType")&&"string"==typeof r.FilesystemType&&Object.prototype.hasOwnProperty.call(r,"DeviceIdentifier")&&"string"==typeof r.DeviceIdentifier&&Object.prototype.hasOwnProperty.call(r,"MountPoint")&&"string"==typeof r.MountPoint&&Object.prototype.hasOwnProperty.call(r,"DeviceNode")&&"string"==typeof r.DeviceNode&&(Object.prototype.hasOwnProperty.call(r,"VolumeUUID")&&"string"==typeof r.VolumeUUID||!Object.prototype.hasOwnProperty.call(r,"VolumeUUID"))&&Object.prototype.hasOwnProperty.call(r,"Size")&&"number"==typeof r.Size&&(Object.prototype.hasOwnProperty.call(r,"FreeSpace")&&"number"==typeof r.FreeSpace||Object.prototype.hasOwnProperty.call(r,"APFSContainerFree")&&"number"==typeof r.APFSContainerFree)){const e=r.FilesystemType===d.TYPE_APFS?r.APFSContainerFree:r.FreeSpace,t=Object.prototype.hasOwnProperty.call(r,"VolumeUUID")?r.VolumeUUID:r.DeviceNode,o=this._determineLowSpaceAlert(r.VolumeName,t,e/r.Size*100),i=new m({name:r.VolumeName,volume_type:r.FilesystemType,disk_id:r.DeviceIdentifier,mount_point:r.MountPoint,capacity_bytes:r.Size,device_node:r.DeviceNode,volume_uuid:t,free_space_bytes:e,visible:this._theVisibleVolumeNames.includes(r.VolumeName),shown:n,low_space_alert:o});this._theVolumes.push(i)}else Object.prototype.hasOwnProperty.call(r,"VolumeName")&&"string"==typeof r.VolumeName&&r.VolumeName.length>0&&L("_on_process_diskutil_info_complete: Unable to handle response from diskutil.");else if(Object.prototype.hasOwnProperty.call(r,"Error")&&"boolean"==typeof r.Error&&r.Error){const t=new m({name:e.token.Name,volume_type:e.token.VolumeType,disk_id:e.token.DeviceIdentifier,mount_point:e.token.MountPoint,capacity_bytes:e.token.Size,device_node:e.token.DeviceNode,volume_uuid:e.token.VolumeUUID,free_space_bytes:e.token.FreeSpace,visible:e.token.IsVisible,shown:n,low_space_alert:e.token.LowSpaceAlert});this._theVolumes.push(t)}else this._checkInProgress=!1,t=!0,L("Unexpected call to _on_process_diskutil_info_complete. config."),L(r)}t||this._updateCheckInProgress()}catch(e){this._checkInProgress=!1,t=!0,L(`Error processing 'diskutil info'. Err:${e}`)}else this._checkInProgress=!1,t=!0,L(`Error processing '${e.source.Command} ${e.source.Arguments}'. Err:${e.result}`);t&&this.emit("ready",{results:[]})}}_on_process_disk_utilization_stats_complete(e){if(R(`'${e.source.Command} ${e.source.Arguments}' Spawn Helper Result: valid:${e.valid}`),!this._checkInProgress)return;const t=e.source.Result.toString().split("\r");for(const r of t){const t=r.split("\t");if(2!==t.length)throw this._checkInProgress=!1,L(`Unable to paese '${e.source.Command} ${e.source.Arguments}' results`),Error(`Unable to paese '${e.source.Command} ${e.source.Arguments}' results`);{const e=m.ConvertFrom1KBlockaToBytes(Number.parseInt(t[0],10)),r=t[1].trim();if(L(`du results: Name:${r} Used:${m.ConvertFromBytesToGB(e)} raw:${Number.parseInt(t[0],10)}`),!this._pendingVolumes.includes(r))throw this._checkInProgress=!1,L(`Unexpected call to _on_process_disk_utilization_stats_complete. mount_point:${t[1]}`),new Error(`Unexpected call to _on_process_disk_utilization_stats_complete. mount_point:${t[1]}`);{let t;this._pendingVolumes=this._pendingVolumes.filter((e=>e!==r));const n=this._theVolumes.filter(((e,n)=>{const o=e.MountPoint===r;return o&&(t=n),o}));if(void 0===n||1!==n.length||t<this._theVolumes.length)throw this._checkInProgress=!1,L("Unable to identify unique volumeData item."),new Error("Unable to identify unique volumeData item.");const o=new m({name:n[0].Name,volume_type:n[0].VolumeType,disk_id:n[0].DiskId,mount_point:n[0].MountPoint,capacity_bytes:n[0].Size,device_node:n[0].DeviceNode,volume_uuid:n[0].VolumeUUID,free_space_bytes:n[0].FreeSpace,visible:n[0].IsVisible,low_space_alert:n[0].LowSpaceAlert,used_space_bytes:e});this._theVolumes[t]=o,this._updateCheckInProgress()}}}}_partitionDiskIdentifiers(e){if(void 0===e||!Array.isArray(e))throw new TypeError("disk must be an array");const t=[];for(const r of e){if(!(Object.prototype.hasOwnProperty.call(r,"Partitions")&&r.Partitions.length>0))throw L("_partitionDiskIdentifiers(): drive is not as expected. No partitions."),new TypeError("drive is not as expected. No partitions.");for(const e of r.Partitions){if(!Object.prototype.hasOwnProperty.call(e,"DeviceIdentifier")||"string"!=typeof e.DeviceIdentifier)throw L("_partitionDiskIdentifiers(): partition is not as expected. Missing or Invalid Disk Identifier."),new TypeError("partition is not as expected. Missing or Invalid Disk Identifier.");t.push(e.DeviceIdentifier)}}return t}_apfsDiskIdentifiers(e){if(void 0===e||!Array.isArray(e))throw new TypeError("containers must be an array");const t=[];for(const r of e){if(!Object.prototype.hasOwnProperty.call(r,"APFSVolumes")||!Array.isArray(r.APFSVolumes))throw L("_apfsDiskIdentifiers(): volume is not as expected. (AFPS)"),new TypeError("volume is not as expected. (AFPS)");for(const e of r.APFSVolumes){if(!Object.prototype.hasOwnProperty.call(e,"DeviceIdentifier")||"string"!=typeof e.DeviceIdentifier)throw L("_apfsDiskIdentifiers(): volume is not as expected. Missing or Invalid Disk Identifier."),new TypeError("volume is not as expected. Missing or Invalid Disk Identifier.");t.push(e.DeviceIdentifier)}}return t}}const j=a("vi_process"),U=a("vi_config");j.log=console.log.bind(console),U.log=console.log.bind(console);const M=/\s+/;class B extends k{constructor(e){const t=process.platform;if(void 0===t||"string"!=typeof t||t.length<=0||"linux"!==t.toLowerCase())throw new Error(`Operating system not supported. os:${t}`);super(e),this._dfSpawnInProgress=!1,this._CB__display_free_disk_space_complete=this._on_df_complete.bind(this)}_initiateInterrogation(){this._dfSpawnInProgress=!0;const e=new C;e.on("complete",this._CB__display_free_disk_space_complete),e.Spawn({command:"df",arguments:["--block-size=512","--portability","--print-type","--exclude-type=tmpfs","--exclude-type=devtmpfs"]})}_doReset(){this._dfSpawnInProgress=!1}get _isCheckInProgress(){return this._dfSpawnInProgress}get _watchFolders(){const{username:e}=(0,l.userInfo)();return j(`Username: ${e}`),[`/media/${e}`,"/mnt"]}_on_df_complete(e){if(U(`'${e.source.Command} ${e.source.Arguments}' Spawn Helper Result: valid:${e.valid}`),U(e.result.toString()),void 0!==e.token&&(U("Spawn Token:"),U(e.token)),this._dfSpawnInProgress=!1,this._checkInProgress)if(e.valid&&void 0!==e.result){const t=1,r=-1;e.result.toString().split("\n").slice(t,r).forEach((e=>{const t=e.split(M),r=t.slice(6,t.length);t[6]=r.join(" ");const n={device_node:t[0].toLowerCase(),fs_type:t[1],blocks:Number.parseInt(t[2],10),used_blks:Number.parseInt(t[3],10),avail_blks:Number.parseInt(t[4],10),capacity:Number.parseInt(t[5].slice(0,-1),10),mount_point:t[6]};if(Object.values(d).includes(n.fs_type)){let e=n.mount_point;const t=n.mount_point.split("/");t.length>0&&t[t.length-1].length>0&&(e=t[t.length-1]);const r=this._determineLowSpaceAlert(e,"~~ not used ~~",n.avail_blks/n.blocks*100),o=new m({name:e,volume_type:n.fs_type,mount_point:n.mount_point,volume_uuid:"unknown",device_node:n.device_node,capacity_bytes:512*n.blocks,free_space_bytes:512*(n.blocks-n.used_blks),visible:!0,shown:this._isVolumeShown(n.mount_point),low_space_alert:r});this._theVolumes.push(o)}})),this._updateCheckInProgress()}else this._checkInProgress=!1,j(`Error processing '${e.source.Command} ${e.source.Arguments}'. Err:${e.result}`),this.emit("ready",{results:[]})}}const z=(e=>{var t={};return c.d(t,e),t})({fileURLToPath:()=>o.fileURLToPath}),q=(e=>{var t={};return c.d(t,e),t})({dirname:()=>i.dirname,join:()=>i.join}),G=(0,z.fileURLToPath)("file:///Volumes/GrumpyUsersAndData/Users/pricemi/Documents/SourceCode/GitHub/homebridge-grumptech-volmon/src/main.mjs"),W=(0,q.dirname)(G),Y=a("homebridge"),H={Switch:0},K={CONTROLS:{uuid:"2CF5A6C7-8041-4805-8582-821B19589D60",model:"Control Switches",serial_num:"00000001",service_list:{MANUAL_REFRESH:{type:H.Switch,name:"Refresh",uuid:"23CB97AC-6F0C-46B5-ACF6-78025632A11F",udst:"ManualRefresh"},PURGE_OFFLINE:{type:H.Switch,name:"Purge",uuid:"FEE232D5-8E25-4C1A-89AC-5476B778ADEF",udst:"PurgeOffline"}}}},X=process.platform;let Z,Q,J;class ee{constructor(e,t,r){let n;this._log=e,this._config=t,this._api=r,this._name=this._config.name;const o={};if(Object.prototype.hasOwnProperty.call(this._config,"settings")&&(n=this._config.settings),void 0!==n){if(Object.prototype.hasOwnProperty.call(n,"polling_interval")){if("number"!=typeof n.polling_interval)throw new TypeError(`Configuration item 'polling_interval' must be a number. {${typeof n.polling_interval}}`);o.period_hr=n.polling_interval}if(Object.prototype.hasOwnProperty.call(n,"alarm_threshold")){if("number"!=typeof n.alarm_threshold)throw new TypeError(`Configuration item 'alarm_threshold' must be a number. {${typeof n.alarm_threshold}}`);o.default_alarm_threshold=n.alarm_threshold}if(Object.prototype.hasOwnProperty.call(n,"exclusion_masks")){if(!Array.isArray(n.exclusion_masks))throw new TypeError(`Configuration item 'exclusion_masks' must be an array of strings. {${typeof n.exclusion_masks}}`);{let e=!0;for(const t of n.exclusion_masks)e=e&&"string"==typeof t;e&&(o.exclusion_masks=n.exclusion_masks)}}if(Object.prototype.hasOwnProperty.call(n,"enable_volume_customizations")){if("boolean"!=typeof n.enable_volume_customizations)throw new TypeError(`Configuration item 'enable_volume_customizations' must be a boolean. {${typeof n.enable_volume_customizations}}`);n.enable_volume_customizations&&Object.prototype.hasOwnProperty.call(n,"volume_customizations")&&Array.isArray(n.volume_customizations)&&(o.volume_customizations=n.volume_customizations)}}try{switch(X.toLowerCase()){case"darwin":this._volumeInterrogator=new V(o);break;case"linux":this._volumeInterrogator=new B(o);break;default:this._volumeInterrogator=void 0,this._log(`Operating system not supported. os:${X}`)}}catch(e){this._volumeInterrogator=void 0,this._log(`Unable to create the VolumeInterrogator. err:'${e.message}`)}this._bindDoInitialization=this._doInitialization.bind(this),this._bindDestructorNormal=this._destructor.bind(this,{cleanup:!0}),this._bindDestructorAbnormal=this._destructor.bind(this,{exit:!0}),this._CB_VolumeIterrrogatorScanning=this._handleVolumeInterrogatorScanning.bind(this),this._CB_VolumeIterrrogatorReady=this._handleVolumeInterrogatorReady.bind(this),this._log("Creating VolumeInterrogatorPlatform"),this._accessories=new Map,this._volumesData=new Map,this._api.on("didFinishLaunching",this._bindDoInitialization),this._api.on("shutdown",this._bindDestructorNormal),process.on("exit",this._bindDestructorNormal),process.on("uncaughtException",this._bindDestructorAbnormal),void 0!==this._volumeInterrogator&&(this._volumeInterrogator.on("scanning",this._CB_VolumeIterrrogatorScanning),this._volumeInterrogator.on("ready",this._CB_VolumeIterrrogatorReady))}async _destructor(e,t){(e.exit||e.cleanup)&&void 0!==this._volumeInterrogator&&(this._log.debug("Terminating the volume interrogator."),this._volumeInterrogator.removeListener("scanning",this._CB_VolumeIterrrogatorScanning),this._volumeInterrogator.removeListener("ready",this._CB_VolumeIterrrogatorReady),await this._volumeInterrogator.Terminate(),this._volumeInterrogator=void 0)}async _doInitialization(){if(this._log(`Homebridge Plug-In ${Z.CONFIG_INFO.platform} has finished launching.`),void 0===this._volumeInterrogator)return void this._log("Volume Interrogator not set.");let e;if(Object.prototype.hasOwnProperty.call(this._config,"settings")&&(e=this._config.settings),void 0!==e){if(!Object.prototype.hasOwnProperty.call(e,"polling_interval")||"number"!=typeof e.polling_interval)throw new TypeError(`Configuration item 'polling_interval' must be a number. {${typeof e.polling_interval}}`);if(!(e.polling_interval>=this._volumeInterrogator.MinimumPeriod&&e.polling_interval<=this._volumeInterrogator.MaximumPeriod))throw new RangeError(`Configuration item 'polling_interval' must be between ${this._volumeInterrogator.MinimumPeriod} and ${this._volumeInterrogator.MaximumPeriod}. {${e.polling_interval}}`);this._volumeInterrogator.Period=e.polling_interval}const t=[];for(const e of this._accessories.values())Object.prototype.hasOwnProperty.call(e.context,"VERSION")&&2===e.context.VERSION||(this._log(`Accessory ${e.displayName} has accessory version ${e.context.VERSION}. Version 2 is expected.`),t.push(e));if(t.forEach((e=>{this._removeAccessory(e)})),!this._accessories.has(K.CONTROLS.model)){const e=new Q(K.CONTROLS.model,K.CONTROLS.uuid);e.context.ID=K.CONTROLS.model,e.context.VERSION=2,e.context.SETTINGS={SwitchStates:[{id:K.CONTROLS.service_list.MANUAL_REFRESH.uuid,state:!0},{id:K.CONTROLS.service_list.PURGE_OFFLINE.uuid,state:!1}]};for(const t of Object.values(K.CONTROLS.service_list)){const r=this._getAccessoryServiceType(t.type),n=e.addService(r,t.uuid,t.udst);void 0!==n&&n.updateCharacteristic(J.Characteristic.Name,`${t.name}`)}this._updateAccessoryInfo(e,{model:K.CONTROLS.model,serialnum:K.CONTROLS.serial_num}),this._configureAccessory(e),this._api.registerPlatformAccessories(Z.CONFIG_INFO.plugin,Z.CONFIG_INFO.platform,[e])}this._volumeInterrogator.Start()}configureAccessory(e){if(void 0===e||!(e instanceof Q))throw new TypeError("accessory must be a PlatformAccessory");let t=!1;for(const r of this._accessories.values())if(r===e){t=!0;break}if(!t)try{this._configureAccessory(e)}catch(t){this._log(`Unable to configure accessory ${e.displayName}. Version:${e.context.VERSION}. Error:${t}`),this._accessories.set(e.displayName,e)}}_handleVolumeInterrogatorScanning(){setImmediate((()=>{this._log.debug("Scanning initiated.");const e=this._accessories.get(K.CONTROLS.model);if(void 0!==e){const t=e.getService(K.CONTROLS.service_list.MANUAL_REFRESH.udst);void 0!==t?this._getAccessorySwitchState(t)?this._log.debug("Refresh switch is already On."):(this._log.debug("Setting Refresh switch On."),t.updateCharacteristic(J.Characteristic.On,!0)):this._log.debug("Unable to find Manual Refresh service.")}else this._log.debug("Unable to find CONTROLS accessory")}))}_handleVolumeInterrogatorReady(e){setImmediate((e=>{if(void 0===e||!Object.prototype.hasOwnProperty.call(e,"results"))throw new TypeError("'data' needs to be an object with a 'results' field.");if(!Array.isArray(e.results))throw new TypeError("'data.results' needs to be an array of VolumeData objects.");for(const t of e.results)if(!(t instanceof m))throw new TypeError("'results' needs to be an array of VolumeData objects.");for(const t of e.results)t.IsMounted&&this._log.debug(`\tName:${t.Name.padEnd(20," ")}\tVisible:${t.IsVisible}\tShown:${t.IsShown}\tSize:${m.ConvertFromBytesToGB(t.Size).toFixed(4)} GB\tUsed:${(t.UsedSpace/t.Size*100).toFixed(2)}%\tMnt:${t.MountPoint}`),this._volumesData.set(t.Name,t);for(const e of this._volumesData.values())try{const t=this._accessories.has(e.Name);e.IsShown&&!t&&this._addBatteryServiceAccessory(e.Name);const r=this._accessories.get(e.Name);void 0!==r&&this._updateBatteryServiceAccessory(r)}catch(t){this._log.debug(`Error when managing accessory: ${e.Name}`)}const t=this._accessories.get(K.CONTROLS.model);if(void 0!==t){const r=t.getServiceById(K.CONTROLS.service_list.PURGE_OFFLINE.uuid,K.CONTROLS.service_list.PURGE_OFFLINE.udst);if(void 0!==r&&this._getAccessorySwitchState(r)){const t=[];for(const r of this._volumesData.values()){const n=e.results.find((e=>e.Name===r.Name));!this._accessories.has(r.Name)||r.IsShown&&void 0!==n||t.push(this._accessories.get(r.Name))}const r=[K.CONTROLS.model];for(const e of this._accessories.keys())this._volumesData.has(e)||-1!==r.indexOf(e)||t.push(this._accessories.get(e));t.forEach((e=>{this._volumesData.delete(e.displayName),this._removeAccessory(e)}))}const n=t.getServiceById(K.CONTROLS.service_list.MANUAL_REFRESH.uuid,K.CONTROLS.service_list.MANUAL_REFRESH.udst);void 0!==n&&this._getAccessorySwitchState(n)&&n.updateCharacteristic(J.Characteristic.On,!1)}const r=[];for(const e of this._accessories.values())r.push(e);r.length>0&&this._api.updatePlatformAccessories(r)}),e)}_addBatteryServiceAccessory(e){if(void 0===e||"string"!=typeof e)throw new TypeError("name must be a string");if(e.length<=0)throw new RangeError("name must be a non-zero length string.");if(this._accessories.has(e))throw new Error(`Accessory '${e}' is already registered.`);this._log.debug(`Adding new accessory: name:'${e}'`);const t=J.uuid.generate(e),r=new Q(e,t);r.addService(J.Service.BatteryService,e),r.context.VERSION=2;try{this._configureAccessory(r)}catch(e){this._log.debug("Error when configuring accessory.")}this._api.registerPlatformAccessories(Z.CONFIG_INFO.plugin,Z.CONFIG_INFO.platform,[r])}_configureAccessory(e){if(void 0===e||!(e instanceof Q))throw new TypeError("accessory must be a PlatformAccessory");let t;this._log.debug(`Configuring accessory ${e.displayName}`),e.on(Q.PlatformAccessoryEvent.IDENTIFY,(()=>{this._log(`${e.displayName} identified!`)}));const r=e.context.SETTINGS;void 0!==r&&"object"==typeof r&&Object.prototype.hasOwnProperty.call(r,"SwitchStates")&&Array.isArray(r.SwitchStates)&&(t=r.SwitchStates);for(const r of e.services)if(r instanceof J.Service.Switch){let n=!0;if(Array.isArray(t))for(const e of t)if("object"==typeof e&&Object.prototype.hasOwnProperty.call(e,"id")&&"string"==typeof e.id&&Object.prototype.hasOwnProperty.call(e,"state")&&"boolean"==typeof e.state&&e.id===r.displayName){n=e.state;break}r.updateCharacteristic(J.Characteristic.On,n);const o=r.getCharacteristic(J.Characteristic.On),i=`${r.displayName}.${r.subtype}`;o.on("get",this._handleOnGet.bind(this,{accessory:e,service_id:i})),o.on("set",this._handleOnSet.bind(this,{accessory:e,service_id:i}))}this._accessories.has(e.displayName)||(this._log.debug(`Adding accessory '${e.displayName} to the accessories list. Count:${this._accessories.size}`),this._accessories.set(e.displayName,e))}_removeAccessory(e){if(void 0===e||!(e instanceof Q))throw new TypeError("Accessory must be a PlatformAccessory");if(!this._accessories.has(e.displayName))throw new RangeError(`Accessory '${e.displayName}' is not registered.`);this._log.debug(`Removing accessory '${e.displayName}'`),e.removeAllListeners(Q.PlatformAccessoryEvent.IDENTIFY);for(const t of e.services)if(t instanceof J.Service.Switch){const r=t.getCharacteristic(J.Characteristic.On),n=`${t.displayName}.${t.subtype}`;r.off("get",this._handleOnGet.bind(this,{accessory:e,service_id:n})),r.off("set",this._handleOnSet.bind(this,{accessory:e,service_id:n}))}this._api.unregisterPlatformAccessories(Z.CONFIG_INFO.plugin,Z.CONFIG_INFO.platform,[e]),this._accessories.delete(e.displayName)}_updateBatteryServiceAccessory(e){if(void 0===e||!(e instanceof Q))throw new TypeError("Accessory must be a PlatformAccessory");this._log.debug(`Updating accessory '${e.displayName}'`);const t=new Error(`Volume '${e.displayName} is not reachable.`);let r=t,n=t,o=t,i=t,s=t;if(this._volumesData.has(e.displayName)){const t=this._volumesData.get(e.displayName);t.IsShown&&(r=t.PercentFree.toFixed(0),n=t.LowSpaceAlert,o=J.Characteristic.ChargingState.NOT_CHARGEABLE),i=t.VolumeType,s=t.VolumeUUID}const a=e.getService(J.Service.BatteryService);void 0!==a&&(a.updateCharacteristic(J.Characteristic.ChargingState,o),a.updateCharacteristic(J.Characteristic.BatteryLevel,r),a.updateCharacteristic(J.Characteristic.StatusLowBattery,n)),this._updateAccessoryInfo(e,{model:i,serialnum:s})}_updateAccessoryInfo(e,t){if(void 0===e||!(e instanceof Q))throw new TypeError("Accessory must be a PlatformAccessory");if(void 0===t||!Object.prototype.hasOwnProperty.call(t,"model")||"string"!=typeof t.model||t.model instanceof Error||!Object.prototype.hasOwnProperty.call(t,"serialnum")||"string"!=typeof t.serialnum||t.serialnum instanceof Error)throw new TypeError("info must be an object with properties named 'model' and 'serialnum' that are either strings or Error");const r=e.getService(J.Service.AccessoryInformation);void 0!==r&&(r.updateCharacteristic(J.Characteristic.Manufacturer,"GrumpTech"),r.updateCharacteristic(J.Characteristic.Model,t.model),r.updateCharacteristic(J.Characteristic.SerialNumber,t.serialnum))}_handleOnGet(e,t){if(void 0===e||"object"!=typeof e||!Object.prototype.hasOwnProperty.call(e,"accessory")||!Object.prototype.hasOwnProperty.call(e,"service_id"))throw new TypeError("event_info must be an object with an 'accessory' and 'service_id' field.");if(void 0===e.accessory||!(e.accessory instanceof Q))throw new TypeError("'event_info.accessory' must be a PlatformAccessory");if(void 0===e.service_id||"string"!=typeof e.service_id||e.service_id.length<=0)throw new TypeError("'event_info.service_id' must be non-null string.");const r=e.service_id.split(".");if(!Array.isArray(r)||2!==r.length)throw new TypeError(`'event_info.service_id' does not appear to be valid. '${e.service_id}'`);const n=e.accessory.getServiceById(r[0],r[1]);if(void 0===n)throw new RangeError("'event_info.service_id' does not belong to event_info.accessory.");if(!(n instanceof J.Service.Switch))throw new TypeError("'event_info.service_id' must correspond to a switch service.");this._log.debug(`Switch '${e.accessory.displayName}-${n.displayName}.${n.subtype}' Get Request.`);let o,i=null;try{o=this._getAccessorySwitchState(n)}catch(t){this._log.debug(`  Unexpected error encountered: ${t.message}`),o=!1,i=new Error(`Accessory ${e.accessory.displayName} is not ressponding.`)}t(i,o)}_handleOnSet(e,t,r){if(void 0===e||"object"!=typeof e||!Object.prototype.hasOwnProperty.call(e,"accessory")||!Object.prototype.hasOwnProperty.call(e,"service_id"))throw new TypeError("event_info must be an object with an 'accessory' and 'service_id' field.");if(void 0===e.accessory||!(e.accessory instanceof Q))throw new TypeError("'event_info.accessory' must be a PlatformAccessory");if(void 0===e.service_id||"string"!=typeof e.service_id||e.service_id.length<=0)throw new TypeError("'event_info.service_id' must be non-null string.");const n=e.service_id.split(".");if(!Array.isArray(n)||2!==n.length)throw new TypeError(`'event_info.service_id' does not appear to be valid. '${e.service_id}'`);const o=e.accessory.getServiceById(n[0],n[1]);if(void 0===o)throw new RangeError("'event_info.service_id' does not belong to event_info.accessory.");if(!(o instanceof J.Service.Switch))throw new TypeError("'event_info.service_id' must correspond to a switch service.");let i;this._log.debug(`Switch '${e.accessory.displayName}-${o.displayName}.${o.subtype}' Set Request. New state:${t}`);const s=e.accessory.context.SETTINGS;if(void 0!==s&&"object"==typeof s&&Object.prototype.hasOwnProperty.call(s,"SwitchStates")&&Array.isArray(s.SwitchStates))for(const e of s.SwitchStates)e.id===o.displayName&&(i=e);let a=null,c=t;try{if(n[0]===K.CONTROLS.service_list.MANUAL_REFRESH.uuid&&n[1]===K.CONTROLS.service_list.MANUAL_REFRESH.udst){const r=this._getAccessorySwitchState(o);!t&&r?(this._log.debug(`Unable to turn the '${e.accessory.displayName}' switch off.`),a=new Error(`Unable to turn the '${e.accessory.displayName}' switch off.`),setImmediate(((e,t)=>{void 0!==o&&(this._log.debug(`Switch '${o.displayName}' Restoring state ${t}`),o.updateCharacteristic(J.Characteristic.On,t))}),e,r),c=r):t&&this._volumeInterrogator.Start()}}catch(t){this._log.debug(`  Unexpected error encountered: ${t.message}`),a=new Error(`Accessory ${e.accessory.displayName} is not ressponding.`)}void 0!==i&&(i.state=c),r(a)}_getAccessorySwitchState(e){if(void 0===e||!(e instanceof J.Service.Switch))throw new TypeError("'switchService' must be a _hap.Service.Switch");let t=!1;const r=e.getCharacteristic(J.Characteristic.On);if(void 0===r)throw new Error(`The '${e.displayName}.${e.udst}' service  does not have an On charactristic.`);return t=r.value,t}_getAccessoryServiceType(e){if(void 0===e||"number"!=typeof e||Object.values(H).indexOf(e)<0)throw new TypeError(`service_type not a member of FIXED_ACCESSORY_SERVICE_TYPES. ${e}`);let t;if(e!==H.Switch)throw new Error(`This cannot happen !! service_type=${e}`);return t=J.Service.Switch,t}}const te=e=>{if(Y(`homebridge API version: v${e.version}`),Z=function(){const e=(0,q.join)(W,"../package.json"),t=(0,_.readFileSync)(e),r=JSON.parse(t);return{CONFIG_INFO:r.config_info,PLUGIN_VER:r.version}}(),Q=e.platformAccessory,!Object.prototype.hasOwnProperty.call(Q,"PlatformAccessoryEvent")){const e={IDENTIFY:"identify"};Q.PlatformAccessoryEvent=e}J=e.hap,Y(`Registering platform: ${Z.CONFIG_INFO.platform}`),e.registerPlatform(Z.CONFIG_INFO.platform,ee)}})();var l=u.Z;export{l as default};